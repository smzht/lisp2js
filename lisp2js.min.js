"use strict";function _typeof2(r){return r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r}function _typeof(r){return r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":"undefined"==typeof r?"undefined":_typeof2(r)}!function(r,n){var e="undefined"!=typeof window?window:"undefined"!=typeof GLOBAL?GLOBAL:{},t=r(e);n(t),"undefined"!=typeof module?module.exports=t:e.LISP=t}(function(r){var n={},e=function b(r){for(var b=n.nil,e=r.length;--e>=0;)b=n.cons(r[e],b);return b},t=function(r){return r?n.t:n.nil},i=function w(r,n){var e=r.length-n;if(0>=e)return[];for(var t=new Array(e),w=0;e>w;++w)t[w]=r[w+n];return t},u=function k(r,e){return r===n.nil?"nil":r===n.t?"t":"string"==typeof r?e?f(r):r:r instanceof Array?"#("+r.map(function(r){return k(r,e)}).join(" ")+")":null==r?""+r:r.toString(e)};n.nil=!1,n.t=!0,n.isTrue=function(r){return r!==n.nil&&null!=r},n._getRestArgs=function(r,n){return e(Array.prototype.slice.call(r,n))},n._output="undefined"!=typeof process?function(r){process.stdout.write(r)}:function(r){console.log(r)};var c={};n["register-macro"]=function(r,n){return c[r]=n,r},n["macroexpand-1"]=function(r){if(!(n["pair?"](r)&&r.car in c))return r;var e=c[r.car];return n.apply(e,r.cdr)},n.error=function(){throw i(arguments,0).join(", ")};var o=function(r){this.name=r};o.prototype={toString:function(){return this.name}},n["symbol->string"]=function(r){return r.name},n.intern=function(){var r={};return function(n){return n in r?r[n]:r[n]=new o(n)}}(),n.gensym=function(){var r=0;return function(){return n.intern("__"+ ++r)}}(),n["symbol?"]=function(r){return t(r instanceof o)};var s=function(r){this.name=r};s.prototype={toString:function(r){return r?":"+this.name:this.name}},n["make-keyword"]=function(){var r={};return function(n){return n in r?r[n]:r[n]=new s(n)}}(),n["keyword?"]=function(r){return t(r instanceof s)},n["keyword->string"]=function(r){return r.name},n.type=function(r){var e;if(r===n.nil||r===n.t)e="bool";else{var e="undefined"==typeof r?"undefined":_typeof(r);"object"===e&&(r instanceof o?e="symbol":r instanceof s?e="keyword":r instanceof a?e="pair":r instanceof Array?e="vector":r instanceof n.HashTable&&(e="table"))}return n.intern(e)},n["eq?"]=function(r,n){return t(r===n)};var a=function(r,n,e,t){this.car=r,this.cdr=n,null!=e&&(this.lineNo=e,this.path=t)};a.prototype={toString:function(){var r={quote:"'",quasiquote:"`",unquote:",","unquote-splicing":",@"};return function(e){if(this.car instanceof o&&this.cdr instanceof a&&this.cdr.cdr&&this.car.name in r)return r[this.car.name]+u(this.cdr.car,e);var t,i=[],c="(";for(t=this;t instanceof a;t=t.cdr)i.push(c),i.push(u(t.car,e)),c=" ";return t!==n.nil&&(i.push(" . "),i.push(u(t,e))),i.push(")"),i.join("")}}(),toArray:function(){for(var r=[],n=this;n instanceof a;n=n.cdr)r.push(n.car);return r}},n.cons=function(r,n){return new a(r,n)},n.car=function(r){return r instanceof a?r.car:r},n.cdr=function(r){return r instanceof a?r.cdr:n.nil},n["set-car!"]=function(r,n){return r.car=n},n["set-cdr!"]=function(r,n){return r.cdr=n},n["pair?"]=function(r){return t(r instanceof a)},n.list=function(){for(var r=n.nil,e=arguments.length;--e>=0;)r=n.cons(arguments[e],r);return r},n["reverse!"]=function(r){for(var e=n.nil,t=r;n["pair?"](t);){var i=t.cdr;t.cdr=e,e=t,t=i}return e},n["number?"]=function(r){return t("number"==typeof r)},n["number->string"]=function(r,n){return r.toString(n)},n["+"]=function(){if(0==arguments.length)return 0;for(var r=arguments[0],n=1;n<arguments.length;++n)r+=arguments[n];return r},n["*"]=function(){if(0==arguments.length)return 1;for(var r=arguments[0],n=1;n<arguments.length;++n)r*=arguments[n];return r},n["-"]=function(){if(0==arguments.length)return 0;var r=arguments[0];if(1==arguments.length)return-r;for(var n=1;n<arguments.length;++n)r-=arguments[n];return r},n["/"]=function(){if(0==arguments.length)return 1;var r=arguments[0];if(1==arguments.length)return 1/r;for(var n=1;n<arguments.length;++n)r/=arguments[n];return r},n["%"]=function(){if(0==arguments.length)return 0;var r=arguments[0];if(1==arguments.length)return r;for(var n=1;n<arguments.length;++n)r%=arguments[n];return r},n["<"]=function(){if(arguments.length>0)for(var r=arguments[0],e=1;e<arguments.length;++e){var t=arguments[e];if(!(t>r))return n.nil;r=t}return n.t},n[">"]=function(){if(arguments.length>0)for(var r=arguments[0],e=1;e<arguments.length;++e){var t=arguments[e];if(!(r>t))return n.nil;r=t}return n.t},n["<="]=function(){if(arguments.length>0)for(var r=arguments[0],e=1;e<arguments.length;++e){var t=arguments[e];if(!(t>=r))return n.nil;r=t}return n.t},n[">="]=function(){if(arguments.length>0)for(var r=arguments[0],e=1;e<arguments.length;++e){var t=arguments[e];if(!(r>=t))return n.nil;r=t}return n.t},n["string?"]=function(r){return t("string"==typeof r)},n["string=?"]=function(r,n){return t(r===n)},n["string-append"]=function(){return i(arguments,0).join("")},n["string-join"]=function(r,e){return r===n.nil?"":r.toArray().join(e)},n["string-length"]=function(r){return r.length},n["string-ref"]=function(r,n){return r[n]},n.substring=function(r,n,e){return r.slice(n,e)},n["string-scan"]=function(r,e){var t=r.indexOf(e);return t>=0?t:n.nil},n["char->integer"]=function(r,n){return r.charCodeAt(n)};var l={"\\":"\\\\","	":"\\t","\n":"\\n",'"':'\\"'},f=function(r){var n=function(r){return r in l?l[r]:"\\x"+("0"+r.charCodeAt(0).toString(16)).slice(-2)};return'"'+r.replace(/[\x00-\x1f"\\]/g,n)+'"'};n["x->string"]=u,n.print=function(r){return n._output(u(r)),r},n.puts=function(r){return n._output(u(r)),"undefined"!=typeof process&&n._output("\n"),r},n.write=function(r){return n._output(u(r,10)),r},n.apply=function(r){var e=[];if(arguments.length>1){for(var t=1;t<arguments.length-1;++t)e.push(arguments[t]);var i=arguments[arguments.length-1];i!==n.nil&&(e=e.concat(i.toArray()))}return r.apply(null,e)},n.JS=r,n.HashTable=function(){},n.HashTable.prototype={toString:function(){var r="";for(var n in this)this.hasOwnProperty(n)&&(r.length>0&&(r+=", "),r+=n+":"+this[n]);return"#table<"+r+">"}},n["make-hash-table"]=function(){return new n.HashTable},n["hash-table?"]=function(r){return r instanceof n.HashTable},n["hash-table-exists?"]=function(r,e){return e in r?n.t:n.nil},n["hash-table-get"]=function(r,e){return e in r?r[e]:arguments.length>=3?arguments[2]:n.nil},n["hash-table-put!"]=function(r,n,e){return r[n]=e},n.vector=function(){return i(arguments,0)},n["make-vector"]=function(r,e){void 0===e&&(e=n.nil);for(var t=new Array(r),i=0;r>i;++i)t[i]=e;return t},n["vector?"]=function(r){return t(r instanceof Array)},n["vector-length"]=function(r){return r.length},n["vector-ref"]=function(r,n){return r[n]},n["vector-set!"]=function(r,n,e){return r[n]=e},n["regexp?"]=function(r){return t(r instanceof RegExp)},n.rxmatch=function(r,n){return t(r.exec(n))},n["regexp-replace-all"]=function(r,n,e){if(!r.global){var t=r.toString(),i=t.lastIndexOf("/");r=new RegExp(t.slice(1,i),t.slice(i+1)+"g")}return n.replace(r,function(r){return e(function(){return r})})},n["regexp->string"]=function(r){var n=r.toString();return n.slice(1,n.length-1)};var p=function(){this.str="",this.lineNo=0};p.prototype={close:function(){},peek:function(){var r=this.fetch();return null==r?r:this.str[0]},getc:function(){var r=this.peek();return null==r?r:(this.str=this.str.slice(1),r)},match:function(r,n){var e=this.fetch();if(null==e)return e;var t=this.str.match(r);return t&&!n&&(this.str=RegExp.rightContext),t},eof:function(){return null==this.str},getLine:function(){var r=this.str||this.readLine();return this.str="",r},fetch:function(){if(null==this.str)return null;if(""===this.str){if(null==(this.str=this.readLine()))return;++this.lineNo}return this.str}};var d=function(r){p.call(this),this.str=r,this.lineNo=1};d.prototype=Object.create(p.prototype),d.prototype.readLine=function(){return null},n.StrStream=d,n.NoCloseParenException=function(){};var m="\\s(){}\\[\\]'`,;#\"",g=RegExp("^\\.(?=["+m+"])"),v=RegExp("^([^"+m+"]+)"),h={t:"	",n:"\n"},T={},y={read:function(r){do if(r.eof())return null;while(r.match(/^\s+/));var n=r.peek();if(n in T)return T[n](r,r.getc());var e;return r.match(/^\(/)?y.readList(r):r.match(/^;[^\n]*\n?/)?y.read(r):(e=r.match(/^"((\\.|[^"\\])*)"/))?y.unescape(e[1]):r.match(/^#\(/)?y.readVector(r):(e=r.match(/^#\/([^\/]*)\//))?new RegExp(e[1]):r.match(/^#\|(.|[\n\r])*?\|#/)?y.read(r):r.match(g,!0)?void 0:(e=r.match(v))?y.readSymbolOrNumber(e[1]):void 0},readSymbolOrNumber:function(r){return"nil"===r?n.nil:"t"===r?n.t:":"===r[0]?n["make-keyword"](r.slice(1)):r.match(/^([+\-]?[0-9]+(\.[0-9]*)?)$/)?parseFloat(r):n.intern(r)},readList:function(r){for(var e=n.nil;;){var t=y.read(r);if(null==t){if(r.match(/^\s*\)/))return n["reverse!"](e);if(r.match(g)){var i=y.read(r);if(null!=i&&r.match(/^\s*\)/)){var u=n["reverse!"](e);return e.cdr=i,u}}throw new n.NoCloseParenException}e=new a(t,e,r.lineNo,r.path)}},readVector:function(r){for(var e=[];;){var t=y.read(r);if(void 0===t){if(r.match(/^\s*\)/))return e;throw new n.NoCloseParenException}e.push(t)}},unescape:function(r){return r.replace(/\\(x([0-9a-fA-F]{2})|(.))/g,function(r,n,e,t){return e?String.fromCharCode(parseInt(e,16)):t in h?h[t]:t})}};if(n["set-macro-character"]=function(r,n){T[r]=n},n["set-macro-character"]("'",function(r,e){return n.list(n.intern("quote"),y.read(r))}),n["set-macro-character"]("`",function(r,e){return n.list(n.intern("quasiquote"),y.read(r))}),n["set-macro-character"](",",function(r,e){var e=r.peek(),t="unquote";return"@"==e&&(t="unquote-splicing",r.getc()),n.list(n.intern(t),y.read(r))}),n.read=function(r){return y.read(r||n["*stdin*"])},n["read-from-string"]=function(r){return y.read(new d(r))},n["read-line"]=function(r){return(r||n["*stdin*"]).getLine()},"undefined"!=typeof process){var q=require("fs");n.FileStream=function(){var r=4096,e=new Buffer(r),t=function(r,n){p.call(this),this.fd=r,this.path=n,this.lines=[],this.index=0};return t.prototype=Object.create(p.prototype),t.prototype.close=function(){null!=this.fd&&(q.closeSync(this.fd),this.fd=null,this.lines.length=this.index=0,this.str=null,this.chomped=!1)},t.prototype.readLine=function(){for(;;){var t="";if(this.index<this.lines.length){if(this.index<this.lines.length-1||!this.chomped)return this.lines[this.index++];this.chomped&&(t=this.lines[this.index])}if(null==this.fd)return n.nil;var i=q.readSync(this.fd,e,0,r);if(0>=i)return null;var u=t+e.slice(0,i).toString();this.chomped=!1,u.length>0&&("\n"!=u[u.length-1]?this.chomped=!0:u=u.slice(0,u.length-1)),this.lines=u.split("\n"),this.index=0}},t}(),n["*stdin*"]=new n.FileStream(process.stdin.fd,"*stdin*"),n["*stdout*"]=new n.FileStream(process.stdout.fd,"*stdout*"),n["*stderr*"]=new n.FileStream(process.stderr.fd,"*stderr*"),n.open=function(r,e){try{var t=q.openSync(r,e||"r");return new n.FileStream(t,r)}catch(i){return n.nil}},n.close=function(r){return r.close(),r},n.load=function(r){var e=n.open(r);if(!e)return n.error("Cannot open ["+r+"]");e.match(/^#!/,!0)&&e.getLine();for(var t;;){var i=n.read(e);if(null==i)break;t=n.eval(i)}return n.close(e),t},n.exit=function(r){process.exit(r)},n.jsrequire=require}return n["register-macro"](n.intern("defmacro"),function(r,e){var t=n._getRestArgs(arguments,2);return n.list(n.intern("register-macro"),n.list(n.intern("quote"),r),n["list*"](n.intern("lambda"),e,t))}),n["register-macro"](n.intern("defun"),function(r,e){var t=n._getRestArgs(arguments,2);return n.list(n.intern("def"),r,n["list*"](n.intern("lambda"),e,t))}),n["register-macro"](n.intern("let"),function(r){var e=n._getRestArgs(arguments,1);return n.isTrue(n["symbol?"](r))?function(){var r=n.list(n.nil);return function(e,t,i){return n["list*"](n.list(n.intern("lambda"),n.list(e),n.list(n.intern("set!"),e,n["list*"](n.intern("lambda"),n.map(n.car,t),i)),n["list*"](e,n.map(n.cadr,t))),r)}}()(r,n.car(e),n.cdr(e)):n["list*"](n["list*"](n.intern("lambda"),n.map(n.car,r),e),n.map(n.cadr,r))}),n["register-macro"](n.intern("let1"),function(r,e){var t=n._getRestArgs(arguments,2);return n["list*"](n.intern("let"),n.list(n.list(r,e)),t)}),n["register-macro"](n.intern("let*"),function(r){var e=n._getRestArgs(arguments,1);return n.isTrue(n["null?"](r))?n["list*"](n.intern("do"),e):n.list(n.intern("let1"),n.caar(r),n.cadar(r),n["list*"](n.intern("let*"),n.cdr(r),e))}),n["register-macro"](n.intern("when"),function(r){var e=n._getRestArgs(arguments,1);return n.list(n.intern("if"),r,n["list*"](n.intern("do"),e))}),n["register-macro"](n.intern("unless"),function(r){var e=n._getRestArgs(arguments,1);return n.list(n.intern("if"),r,n.nil,n["list*"](n.intern("do"),e))}),n["register-macro"](n.intern("cond"),function(){var r=n._getRestArgs(arguments,0);return n.isTrue(n["null?"](r))?n.nil:function(r,e){return n.isTrue(n["eq?"](n.car(r),n.t))?n["list*"](n.intern("do"),n.cdr(r)):n.isTrue(n["null?"](n.cdr(r)))?function(t){return n.list(n.intern("let"),n.list(n.list(t,n.car(r))),n.list(n.intern("if"),t,t,n["list*"](n.intern("cond"),e)))}(n.gensym()):n.isTrue(n["eq?"](n.cadr(r),n.intern("=>")))?function(t){return n.list(n.intern("let"),n.list(n.list(t,n.car(r))),n.list(n.intern("if"),t,n.list(n.caddr(r),t),n["list*"](n.intern("cond"),e)))}(n.gensym()):n.list(n.intern("if"),n.car(r),n["list*"](n.intern("do"),n.cdr(r)),n["list*"](n.intern("cond"),e))}(n.car(r),n.cdr(r))}),n["register-macro"](n.intern("case"),function(r){var e=n._getRestArgs(arguments,1);return function(t){return n.list(n.intern("let1"),t,r,n["list*"](n.intern("cond"),n.map(function(r){return n.isTrue(n["eq?"](n.car(r),n.t))?r:n.isTrue(n["null?"](n.cdar(r)))?n["list*"](n.list(n.intern("eq?"),t,n.list(n.intern("quote"),n.caar(r))),n.cdr(r)):n["list*"](n.list(n.intern("member"),t,n.list(n.intern("quote"),n.car(r))),n.cdr(r))},e)))}(n.gensym())}),n["register-macro"](n.intern("and"),function(){var r=n.list(n.nil);return function(){var e=n._getRestArgs(arguments,0);return n.isTrue(n["null?"](e))?n.t:n.isTrue(n["null?"](n.cdr(e)))?n.car(e):n["list*"](n.intern("if"),n.car(e),n["list*"](n.intern("and"),n.cdr(e)),r)}}()),n["register-macro"](n.intern("or"),function(){var r=n._getRestArgs(arguments,0);return n.isTrue(n["null?"](n.cdr(r)))?n.car(r):function(e){return n.list(n.intern("let1"),e,n.car(r),n.list(n.intern("if"),e,e,n["list*"](n.intern("or"),n.cdr(r))))}(n.gensym())}),n["register-macro"](n.intern("do"),function(){var r=n._getRestArgs(arguments,0);return n.isTrue(n["null?"](r))?n.nil:n.isTrue(n["null?"](n.cdr(r)))?n.car(r):n["list*"](n.intern("let"),n.nil,r)}),n["register-macro"](n.intern("aif"),function(r,e){var t=n._getRestArgs(arguments,2);return n.list(n.intern("let1"),n.intern("it"),r,n["list*"](n.intern("if"),n.intern("it"),e,t))}),n["register-macro"](n.intern("awhen"),function(r){var e=n._getRestArgs(arguments,1);return n.list(n.intern("aif"),r,n["list*"](n.intern("do"),e))}),n["register-macro"](n.intern("awhile"),function(r){var e=n._getRestArgs(arguments,1);return function(t){return n.list(n.intern("let"),t,n.nil,n.list(n.intern("let1"),n.intern("it"),r,n["list*"](n.intern("when"),n.intern("it"),n.append(e,n.list(n.list(t))))))}(n.gensym())}),n["null?"]=function(r){return n["eq?"](r,n.nil)},n.not=function(r){return n["eq?"](r,n.nil)},n.caar=function(r){return n.car(n.car(r))},n.cadr=function(r){return n.car(n.cdr(r))},n.cdar=function(r){return n.cdr(n.car(r))},n.cddr=function(r){return n.cdr(n.cdr(r))},n.cadar=function(r){return n.cadr(n.car(r))},n.caddr=function(r){return n.car(n.cddr(r))},n.cdddr=function(r){return n.cdr(n.cddr(r))},n["equal?"]=function(r,e){return n.isTrue(n["eq?"](r,e))?n.t:function(t){return n.isTrue(n["eq?"](t,n.type(e)))?function(t){return n.isTrue(n["eq?"](t,n.intern("pair")))?n.isTrue(n["equal?"](n.car(r),n.car(e)))?n["equal?"](n.cdr(r),n.cdr(e)):n.nil:n.isTrue(n["eq?"](t,n.intern("vector")))?function(t){return n.isTrue(n["eq?"](t,n["vector-length"](e)))?function(i){return(i=function(u){return function(t){return n.isTrue(t)?t:n.isTrue(n["equal?"](n["vector-ref"](r,u),n["vector-ref"](e,u)))?i(u+1):n.nil}(n[">="](u,t))})(0)}(n.nil):n.nil}(n["vector-length"](r)):n.nil}(t):n.nil}(n.type(r))},n.length=function(r){return function(e){return(e=function(r,t){return n.isTrue(n["pair?"](r))?e(n.cdr(r),t+1):t})(r,0)}(n.nil)},n["last-pair"]=function(r){return n.isTrue(n["pair?"](n.cdr(r)))?n["last-pair"](n.cdr(r)):r},n.member=function(r,e){return n.isTrue(n["null?"](e))?n.nil:n.isTrue(n["eq?"](r,n.car(e)))?e:n.member(r,n.cdr(e))},n.assoc=function(r,e){return n.isTrue(n["null?"](e))?n.nil:n.isTrue(n["eq?"](r,n.caar(e)))?n.car(e):n.assoc(r,n.cdr(e))},n.acons=function(r,e,t){return n.cons(n.cons(r,e),t)},n.map=function(r,e){return n.isTrue(n["null?"](e))?n.nil:n.cons(r(n.car(e)),n.map(r,n.cdr(e)))},n.append=function(r){var e=n._getRestArgs(arguments,1);return n.isTrue(n["null?"](e))?r:n.isTrue(n["null?"](r))?n.apply(n.append,e):n.cons(n.car(r),n.apply(n.append,n.cdr(r),e))},n.reverse=function(r){return function(e){return(e=function(r,t){return n.isTrue(n["pair?"](r))?e(n.cdr(r),n.cons(n.car(r),t)):t})(r,n.nil)}(n.nil)},n["list*"]=function(){var r=n._getRestArgs(arguments,0);return n.isTrue(n["null?"](r))?n.nil:n.isTrue(n["null?"](n.cdr(r)))?n.car(r):function(e){return(e=function(t,i){return n.isTrue(n["null?"](n.cdr(i)))?function(){return n["set-cdr!"](t,n.car(i)),r}():e(i,n.cdr(i))})(r,n.cdr(r))}(n.nil)},n["last-pair"]=function(r){return n.isTrue(n["pair?"](n.cdr(r)))?n["last-pair"](n.cdr(r)):r},n["proper-list?"]=function(r){return n.isTrue(n["pair?"](r))?n["null?"](n.cdr(n["last-pair"](r))):n.nil},n["dotted->proper"]=function(r){return n.isTrue(n["pair?"](r))?n.isTrue(n["proper-list?"](r))?r:function(r,e){return function(t){return n["set-cdr!"](e,n.list(r)),t}(n["reverse!"](e))}(n.cdr(n["last-pair"](r)),n.reverse(r)):n.list(r)},n["vector->list"]=function(r){return function(e){return(e=function(t,i){return n.isTrue(n["<"](t,0))?i:e(t-1,n.cons(n["vector-ref"](r,t),i))})(n["vector-length"](r)-1,n.nil)}(n.nil)},n["position-if"]=function(r,e){return function(t){return(t=function(e,i){return n.isTrue(e)?n.isTrue(r(n.car(e)))?i:t(n.cdr(e),i+1):n.nil})(e,0)}(n.nil)},n.take=function(r,e){return function(t){return(t=function(r,e,i){return n.isTrue(function(r){return n.isTrue(r)?r:n["null?"](e)}(n["<="](r,0)))?n["reverse!"](i):t(r-1,n.cdr(e),n.cons(n.car(e),i))})(r,e,n.nil)}(n.nil)},n.drop=function(r,e){return n.isTrue(function(r){return n.isTrue(r)?r:n["null?"](e)}(n["<="](r,0)))?e:n.drop(r-1,n.cdr(e))},n.elt=function(r,e){return n.car(n.drop(r,e))},n["remove-if"]=function(r,e){return function(t){return(t=function(e,i){return n.isTrue(n["null?"](e))?n["reverse!"](i):t(n.cdr(e),n.isTrue(r(n.car(e)))?i:n.cons(n.car(e),i))})(e,n.nil)}(n.nil)},n["register-macro"](n.intern("dotimes"),function(r){var e=n._getRestArgs(arguments,1);return function(){var t=n.list(0),i=n.list(1);return function(u,c,o){return n.list(n.intern("let1"),c,n.cadr(r),n.list(n.intern("let"),o,n.list(n["list*"](u,t)),n.list(n.intern("if"),n.list(n.intern("<"),u,c),n["list*"](n.intern("do"),n.append(e,n.list(n.list(o,n["list*"](n.intern("+"),u,i))))),n.caddr(r))))}}()(n.car(r),n.gensym(),n.gensym())}),n["register-macro"](n.intern("dolist"),function(r){var e=n._getRestArgs(arguments,1);return function(t,i,u){return n.list(n.intern("let"),i,n.list(n.list(u,n.cadr(r))),n.list(n.intern("let1"),t,n.list(n.intern("car"),u),n["list*"](n.intern("when"),t,n.append(e,n.list(n.list(i,n.list(n.intern("cdr"),u)))))))}(n.car(r),n.gensym(),n.gensym())}),n["register-macro"](n.intern("labels"),function(r){var e=n._getRestArgs(arguments,1);return n["list*"](n.intern("let"),n.map(function(r){return n.car(r)},r),n.append(n.map(function(r){return n.list(n.intern("set!"),n.car(r),n["list*"](n.intern("lambda"),n.cdr(r)))},r),e))}),n.nreconc=function(r,e){return function(t){return n["set-cdr!"](r,e),t}(n["reverse!"](r))},n.any=function(r,e){return n.isTrue(n["null?"](e))?n.nil:n.isTrue(r(n.car(e)))?n.t:n.any(r,n.cdr(e))},n.every=function(r,e){return n.isTrue(n["null?"](e))?n.t:n.isTrue(r(n.car(e)))?n.every(r,n.cdr(e)):n.nil},n["*bq-clobberable*"]=n.gensym(),n["*bq-quote-nil*"]=n.list(n.intern("quote"),n.nil),n["register-macro"](n.intern("quasiquote"),function(r){return n["bq-completely-process"](r)}),n["bq-completely-process"]=function(r){return n["bq-simplify"](n["bq-process"](r))},n["bq-process"]=function(r){return n.isTrue(n.not(n["pair?"](r)))?n.list(n.intern("quote"),r):n.isTrue(n["eq?"](n.car(r),n.intern("quasiquote")))?n["bq-process"](n["bq-completely-process"](n.cadr(r))):n.isTrue(n["eq?"](n.car(r),n.intern("unquote")))?n.cadr(r):n.isTrue(n["eq?"](n.car(r),n.intern("unquote-splicing")))?n.error(",@~S after `",n.cadr(r)):n.isTrue(n["eq?"](n.car(r),n.intern("unquote-dot")))?n.error(",.~S after `",n.cadr(r)):function(e){return(e=function(r,t){return n.isTrue(n.not(n["pair?"](r)))?n.cons(n.intern("append"),n.nreconc(t,n.list(n.list(n.intern("quote"),r)))):n.isTrue(n["eq?"](n.car(r),n.intern("unquote")))?function(){return n.isTrue(n["null?"](n.cddr(r)))?n.nil:n.error("Malformed ,~S",r),n.cons(n.intern("append"),n.nreconc(t,n.list(n.cadr(r))))}():function(){return n.isTrue(n["eq?"](n.car(r),n.intern("unquote-splicing")))?n.error("Dotted ,@~S",r):n.nil,n.isTrue(n["eq?"](n.car(r),n.intern("unquote-dot")))?n.error("Dotted ,.~S",r):n.nil,e(n.cdr(r),n.cons(n.bracket(n.car(r)),t))}()})(r,n.nil)}(n.nil)},n.bracket=function(r){return n.isTrue(n.not(n["pair?"](r)))?n.list(n.intern("list"),n["bq-process"](r)):n.isTrue(n["eq?"](n.car(r),n.intern("unquote")))?n.list(n.intern("list"),n.cadr(r)):n.isTrue(n["eq?"](n.car(r),n.intern("unquote-splicing")))?n.cadr(r):n.isTrue(n["eq?"](n.car(r),n.intern("unquote-dot")))?n.list(n["*bq-clobberable*"],n.cadr(r)):n.list(n.intern("list"),n["bq-process"](r))},n.maptree=function(r,e){return n.isTrue(n.not(n["pair?"](e)))?r(e):function(r,t){return n.isTrue(n.isTrue(n["equal?"](r,n.car(e)))?n["equal?"](t,n.cdr(e)):n.nil)?e:n.cons(r,t)}(r(n.car(e)),n.maptree(r,n.cdr(e)))},n["bq-splicing-frob"]=function(r){return n.isTrue(n["pair?"](r))?function(e){return n.isTrue(e)?e:n["eq?"](n.car(r),n.intern("unquote-dot"))}(n["eq?"](n.car(r),n.intern("unquote-splicing"))):n.nil},n["bq-frob"]=function(r){return n.isTrue(n["pair?"](r))?function(e){return n.isTrue(e)?e:function(e){return n.isTrue(e)?e:n["eq?"](n.car(r),n.intern("unquote-dot"))}(n["eq?"](n.car(r),n.intern("unquote-splicing")))}(n["eq?"](n.car(r),n.intern("unquote"))):n.nil},n["bq-simplify"]=function(r){return n.isTrue(n["pair?"](r))?function(r){return n.isTrue(n.not(n["eq?"](n.car(r),n.intern("append"))))?r:n["bq-simplify-args"](r)}(n.isTrue(n["eq?"](n.car(r),n.intern("quote")))?r:n.maptree(n["bq-simplify"],r)):r},n["bq-simplify-args"]=function(r){return function(e){return(e=function(r,t){return n.isTrue(n.not(n["null?"](r)))?e(n.cdr(r),n.isTrue(n.not(n["pair?"](n.car(r))))?n["bq-attach-append"](n.intern("append"),n.car(r),t):n.isTrue(n.isTrue(n["eq?"](n.caar(r),n.intern("list")))?n.not(n.any(n["bq-splicing-frob"],n.cdar(r))):n.nil)?n["bq-attach-conses"](n.cdar(r),t):n.isTrue(n.isTrue(n["eq?"](n.caar(r),n.intern("list*")))?n.not(n.any(n["bq-splicing-frob"],n.cdar(r))):n.nil)?n["bq-attach-conses"](n.reverse(n.cdr(n.reverse(n.cdar(r)))),n["bq-attach-append"](n.intern("append"),n.car(n.last(n.car(r))),t)):n.isTrue(n.isTrue(n["eq?"](n.caar(r),n.intern("quote")))&&n.isTrue(n["pair?"](n.cadar(r)))&&n.isTrue(n.not(n["bq-frob"](n.cadar(r))))?n.not(n.cddar(r)):n.nil)?n["bq-attach-conses"](n.list(n.list(n.intern("quote"),n.caadar(r))),t):n.isTrue(n["eq?"](n.caar(r),n["*bq-clobberable*"]))?n["bq-attach-append"](n.intern("append!"),n.cadar(r),t):n["bq-attach-append"](n.intern("append"),n.car(r),t)):t})(n.reverse(n.cdr(r)),n.nil)}(n.nil)},n["null-or-quoted"]=function(r){return function(e){return n.isTrue(e)?e:n.isTrue(n["pair?"](r))?n["eq?"](n.car(r),n.intern("quote")):n.nil}(n["null?"](r))},n["bq-attach-append"]=function(r,e,t){return n.isTrue(n.isTrue(n["null-or-quoted"](e))?n["null-or-quoted"](t):n.nil)?n.list(n.intern("quote"),n.append(n.cadr(e),n.cadr(t))):n.isTrue(function(r){return n.isTrue(r)?r:n["equal?"](t,n["*bq-quote-nil*"])}(n["null?"](t)))?n.isTrue(n["bq-splicing-frob"](e))?n.list(r,e):e:n.isTrue(n.isTrue(n["pair?"](t))?n["eq?"](n.car(t),r):n.nil)?n["list*"](n.car(t),e,n.cdr(t)):n.list(r,e,t)},n["bq-attach-conses"]=function(r,e){return n.isTrue(n.isTrue(n.every(n["null-or-quoted"],r))?n["null-or-quoted"](e):n.nil)?n.list(n.intern("quote"),n.append(n.map(n.cadr,r),n.cadr(e))):n.isTrue(function(r){return n.isTrue(r)?r:n["equal?"](e,n["*bq-quote-nil*"])}(n["null?"](e)))?n.cons(n.intern("list"),r):n.isTrue(n.isTrue(n["pair?"](e))?function(r){return n.isTrue(r)?r:n["eq?"](n.car(e),n.intern("list*"))}(n["eq?"](n.car(e),n.intern("list"))):n.nil)?n.cons(n.car(e),n.append(r,n.cdr(e))):n.cons(n.intern("list*"),n.append(r,n.list(e)))},n.macroexpand=function(r){return function(e){return n.isTrue(n["equal?"](e,r))?r:n.macroexpand(e)}(n["macroexpand-1"](r))},n["create-scope"]=function(r,e){return n.vector(n["remove-if"](function(){var r=n.list(n.intern("&rest"),n.intern("&body"));return function(e){return n.member(e,r)}}(),e),n.nil,r)},n["scope-param"]=function(r){return n["vector-ref"](r,0)},n["scope-outer"]=function(r){return n["vector-ref"](r,2)},n["scope-add-var"]=function(r,e){return function(t){return n["vector-set!"](r,1,n.cons(n.cons(t,e),n["vector-ref"](r,1))),n["vector-set!"](r,0,n.cons(t,n["vector-ref"](r,0))),t}(n.gensym())},n["scope-get-var"]=function(r){return n["vector-ref"](r,1)},n["scope-var?"]=function(r,e){return n.isTrue(n["null?"](r))?n.nil:n.isTrue(n.member(e,n["scope-param"](r)))?n.t:n["scope-var?"](n["scope-outer"](r),e)},n["local-var?"]=function(r,e){return n.isTrue(n["symbol?"](e))?n["scope-var?"](r,n["get-receiver"](e)):n.nil},n["get-receiver"]=function(r){return function(e){return function(t){return n.isTrue(t)?n.intern(n.substring(e,0,t)):r}(n["string-scan"](e,"."))}(n["symbol->string"](r))},n["register-macro"](n.intern("record"),function(r,e){var t=n._getRestArgs(arguments,2);return n.list(n.intern("apply"),n["list*"](n.intern("lambda"),e,t),r)}),n["register-macro"](n.intern("record-case"),function(r){var e=n._getRestArgs(arguments,1);return function(t){return n.list(n.intern("let1"),t,r,n["list*"](n.intern("case"),n.list(n.intern("car"),t),n.map(function(r){return n.isTrue(n["eq?"](n.car(r),n.t))?r:function(e){return n.list(n.list(e),n["list*"](n.intern("record"),n.list(n.intern("cdr"),t),n.cdar(r),n.cdr(r)))}(n.caar(r))},e)))}(n.gensym())}),function(r,e,t){return r=function(r,e){return n.map(function(r){return n["traverse*"](r,e)},r)},e=function(r){return n.isTrue(r)?n.isTrue(n["symbol?"](n.car(r)))?e(n.cdr(r)):n["compile-error"]("function parameter must be symbol, but",n.car(r)):n.nil},t=function(r){return n.isTrue(n["pair?"](r))?n.vector(n["make-keyword"]("FUNCALL"),n.vector(n["make-keyword"]("REF"),n.isTrue(n["proper-list?"](r))?n.intern("list"):n.intern("list*")),n.map(t,n["dotted->proper"](r))):n.vector(n["make-keyword"]("CONST"),r)},n["traverse-list"]=function(i,u){return function(c){return function(o){return n.isTrue(n["eq?"](o,n.intern("quote")))?n.apply(function(r){return n.isTrue(n["pair?"](r))?n.vector(n["make-keyword"]("REF"),n["scope-add-var"](u,t(r))):n.vector(n["make-keyword"]("CONST"),r)},n.cdr(c)):n.isTrue(n["eq?"](o,n.intern("if")))?n.apply(function(r,e){var t=n._getRestArgs(arguments,2);return n.vector(n["make-keyword"]("IF"),n["traverse*"](r,u),n["traverse*"](e,u),n.isTrue(n["null?"](t))?n.nil:n["traverse*"](n.car(t),u))},n.cdr(c)):n.isTrue(n["eq?"](o,n.intern("set!")))?n.apply(function(r,e){return n.vector(n["make-keyword"]("SET!"),n["traverse*"](r,u),n["traverse*"](e,u))},n.cdr(c)):n.isTrue(n["eq?"](o,n.intern("lambda")))?n.apply(function(t){var i=n._getRestArgs(arguments,1);return function(){return e(t),function(e){return n.vector(n["make-keyword"]("LAMBDA"),e,t,r(i,e))}(n["create-scope"](u,t))}()},n.cdr(c)):n.isTrue(n["eq?"](o,n.intern("def")))?n.apply(function(r,e){return n.vector(n["make-keyword"]("DEF"),n["traverse*"](r,u),n["traverse*"](e,u))},n.cdr(c)):n.isTrue(n["eq?"](o,n.intern("new")))?n.apply(function(e){var t=n._getRestArgs(arguments,1);return n.vector(n["make-keyword"]("NEW"),e,r(t,n["new-scope"]))},n.cdr(c)):n.vector(n["make-keyword"]("FUNCALL"),n["traverse*"](n.car(i),u),r(n.cdr(i),u))}(n.car(c))}(i)}}(n.nil,n.nil,n.nil),n["traverse*"]=function(r,e){return n.isTrue(n["pair?"](r))?n.isTrue(n["local-var?"](e,n.car(r)))?n["traverse-list"](r,e):function(r){return n.isTrue(n["pair?"](r))?n["traverse-list"](r,e):n["traverse*"](r,e)}(n.macroexpand(r)):n.isTrue(n["symbol?"](r))?n.vector(n["make-keyword"]("REF"),r):n.vector(n["make-keyword"]("CONST"),r)},n["expand-args"]=function(r,e){return n["string-join"](n.map(function(r){return n["compile*"](r,e)},r),", ")},n["expand-body"]=function(r,e){return n.isTrue(n["null?"](r))?"LISP.nil":n["expand-args"](r,e)},function(r){return n["hash-table-put!"](r,"\\","\\\\"),n["hash-table-put!"](r,"	","\\t"),n["hash-table-put!"](r,"\n","\\n"),n["hash-table-put!"](r,'"','\\"'),n["escape-char"]=function(e){return function(r){return n.isTrue(r)?r:e}(n["hash-table-get"](r,e))}}(n["make-hash-table"]()),n["escape-string"]=function(r){return n["regexp-replace-all"](/[\\\t\n"]/,r,function(r){return n["escape-char"](r())})},n["escape-sym-char"]=function(r){return n["string-append"]("$",n["integer->hex-string"](n["char->integer"](r),"00"))},n["integer->hex-string"]=function(r,e){return function(r){return function(t){return function(e){return n.substring(r,t-e,t)}(n["string-length"](e))}(n["string-length"](r))}(n["string-append"](e,n["number->string"](r,16)))},n["escape-symbol"]=function(r){return n["regexp-replace-all"](/[^0-9A-Za-z_.]/,n["symbol->string"](r),function(r){return n["escape-sym-char"](n["string-ref"](r(),0))})},n["compile-symbol"]=function(r,e){return n.isTrue(n["local-var?"](e,r))?n["escape-symbol"](r):function(r){return n.isTrue(n.rxmatch(/^[0-9A-Za-z_.]*$/,r))?n["string-append"]("LISP.",r):n["string-append"]('LISP["',n["escape-string"](r),'"]')}(n["symbol->string"](r))},n["compile-keyword"]=function(r){return n["string-append"]('LISP["make-keyword"]("',n["escape-string"](n["keyword->string"](r)),'")')},n["compile-vector"]=function(r,e){return n["string-append"]("[",n["string-join"](n.map(function(r){return n["compile-quote"](r,e)},n["vector->list"](r)),", "),"]")},n["compile-regexp"]=function(r){return n["string-append"]("/",n["regexp->string"](r),"/")},n["compile-literal"]=function(r,e){return n.isTrue(n["number?"](r))?n["number->string"](r):n.isTrue(n["symbol?"](r))?n["compile-symbol"](r,e):n.isTrue(n["keyword?"](r))?n["compile-keyword"](r):n.isTrue(n["string?"](r))?n["x->string"](r,n.t):n.isTrue(n["vector?"](r))?n["compile-vector"](r,e):n.isTrue(n["regexp?"](r))?n["compile-regexp"](r):n.isTrue(n["null?"](r))?"LISP.nil":n.isTrue(n["eq?"](r,n.t))?"LISP.t":n.error(n["string-append"]("compile-literal: [",r,"]"))},n["unary-op?"]=function(){var r=n.list(n.intern("+"),n.intern("-"),n.intern("!"),n.intern("~"));return function(e){return n.member(e,r)}}(),n["compile-unary-op"]=function(r,e,t){return n["string-append"]("(",n["symbol->string"](r),n["compile*"](e,t),")")},n["binop?"]=function(){var r=n.list(n.intern("+"),n.intern("-"),n.intern("*"),n.intern("/"),n.intern("%"));return function(e){return n.member(e,r)}}(),n["compile-binop"]=function(r,e,t){return n["string-append"]("(",n["string-join"](n.map(function(r){return n["compile*"](r,t)},e),n["string-append"](" ",n["symbol->string"](r)," ")),")")},n["do-compile-funcall"]=function(r,e,t){return n["string-append"](n["compile*"](r,t),"(",n["expand-args"](e,t),")")},n["compile-funcall"]=function(r,e,t){return n.isTrue(n.isTrue(n["eq?"](n["vector-ref"](r,0),n["make-keyword"]("REF")))&&n.isTrue(n.not(n["local-var?"](t,n["vector-ref"](r,1))))?n.not(n["null?"](e)):n.nil)?function(i){return n.isTrue(n.isTrue(n["binop?"](i))?n.not(n["null?"](n.cdr(e))):n.nil)?n["compile-binop"](i,e,t):n.isTrue(n.isTrue(n["unary-op?"](i))?n["null?"](n.cdr(e)):n.nil)?n["compile-unary-op"](i,n.car(e),t):n["do-compile-funcall"](r,e,t);
}(n["vector-ref"](r,1)):n["do-compile-funcall"](r,e,t)},n["compile-quote"]=function(r,e){return n.isTrue(n["pair?"](r))?n["compile*"](n.list(n.intern("cons"),n.list(n.intern("quote"),n.car(r)),n.list(n.intern("quote"),n.cdr(r))),e):n.isTrue(n["symbol?"](r))?n["string-append"]('LISP.intern("',n["escape-string"](n["symbol->string"](r)),'")'):n.isTrue(n["keyword?"](r))?n["compile-keyword"](r):n["compile-literal"](r,e)},n["compile-if"]=function(r,e,t,i){return n["string-append"]("(LISP.isTrue(",n["compile*"](r,i),") ? (",n["compile*"](e,i),") : (",n.isTrue(t)?n["compile*"](t,i):"LISP.nil","))")},n["compile-set!"]=function(r,e,t){return n["string-append"](n["compile*"](r,t)," = ",n["compile*"](e,t))},n["compile-lambda"]=function(r,e,t,i){return n.isTrue(function(e){return n.isTrue(e)?e:n["pair?"](r)}(n["null?"](r)))?n.nil:n.error("function parameters must be a list"),function(t){return function(r,t){return n["string-append"]("(function(",n["string-join"](n.map(function(r){return n["escape-symbol"](r)},r),", "),"){",n.isTrue(n["null?"](t))?"":n["string-append"]("var ",n["escape-symbol"](t)," = LISP._getRestArgs(arguments, ",n["number->string"](n.length(r)),"); "),"return (",n["expand-body"](e,i),");})")}(n.isTrue(t)?n.take(t,r):r,n.isTrue(t)?n.elt(t+1,r):n.nil)}(n["position-if"](function(){var r=n.list(n.intern("&rest"),n.intern("&body"));return function(e){return n.member(e,r)}}(),r))},n["compile-def"]=function(r,e,t){return n["string-append"](n["compile*"](r,t)," = ",n["compile*"](e,t))},n["compile-new"]=function(r,e,t){return n["string-append"]("new ",n["symbol->string"](r),"(",n["expand-args"](e,t),")")},n["compile-new-scope"]=function(r,e){return function(t){return n.isTrue(t)?n["string-append"]("(function() { var ",n["string-join"](n.map(function(e){return n["string-append"](n["escape-symbol"](n.car(e))," = ",n["compile*"](n.cdr(e),r))},n.reverse(t)),", "),"; return ",e,"; })()"):e}(n["scope-get-var"](r))},n["compile*"]=function(r,e){return function(t){return n.isTrue(n["eq?"](t,n["make-keyword"]("CONST")))?n["compile-quote"](n["vector-ref"](r,1),e):n.isTrue(n["eq?"](t,n["make-keyword"]("REF")))?n["compile-symbol"](n["vector-ref"](r,1),e):n.isTrue(n["eq?"](t,n["make-keyword"]("IF")))?function(r,t,i){return n["compile-if"](r,t,i,e)}(n["vector-ref"](r,1),n["vector-ref"](r,2),n["vector-ref"](r,3)):n.isTrue(n["eq?"](t,n["make-keyword"]("FUNCALL")))?n["compile-funcall"](n["vector-ref"](r,1),n["vector-ref"](r,2),e):n.isTrue(n["eq?"](t,n["make-keyword"]("SET!")))?n["compile-set!"](n["vector-ref"](r,1),n["vector-ref"](r,2),e):n.isTrue(n["eq?"](t,n["make-keyword"]("LAMBDA")))?function(r,t,i){return n["compile-new-scope"](r,n["compile-lambda"](t,i,e,r))}(n["vector-ref"](r,1),n["vector-ref"](r,2),n["vector-ref"](r,3)):n.isTrue(n["eq?"](t,n["make-keyword"]("DEF")))?n["compile-def"](n["vector-ref"](r,1),n["vector-ref"](r,2),e):n.isTrue(n["eq?"](t,n["make-keyword"]("NEW")))?n["compile-new"](n["vector-ref"](r,1),n["vector-ref"](r,2),e):n["compile-error"]("Unknown AST node:",r)}(n["vector-ref"](r,0))},n["compile-error"]=function(){var r=n._getRestArgs(arguments,0);return n.error(r)},n.compile=function(r){return function(e){return function(r){return n["compile-new-scope"](e,n["compile*"](r,e))}(n["traverse*"](r,e))}(n["create-scope"](n.nil,n.nil))},n},function(LISP){LISP.eval=function(exp){return eval(LISP.compile(exp))}});
//# sourceMappingURL=lisp2js.min.js.map
