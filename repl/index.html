<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JsLisp Demo: REPL</title>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="stylesheets/repl.css">
    <style>
    div#repl-txt, div#repl pre.code, div#repl span.error { font-weight: normal; }
    div#codemirror-desc { position: absolute; right: 0; top: 0; z-index: 1; color: white; }
    div#codemirror-desc a { color: white; }
    </style>
    <script src="lib/codemirror/lib/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="lib/codemirror/theme/ambiance.css">
    <script src="lib/codemirror/addon/edit/matchbrackets.js"></script>
    <script src="lib/codemirror/keymap/emacs.js"></script>
    <script src="javascripts/mode/scheme/scheme.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <script src="../js/jslisp.js"></script>
    <script src="javascripts/repl.js"></script>
  </head>
  <body>
    <h1>JsLisp</h1>

    <h3>REPL</h3>
    <div style="width:80%; margin: 0 auto;">
      <div id="repl">
        <div id="repl-txt"></div>
        <div id="holder"></div>
      </div>
    </div>

    <h3>Canvas</h3>
    <div style="width:800px; margin: 0 auto;">
      <div style="width:400px; margin:0; float: left">
        <div id="code-area" style="width:400px; margin:0; background-color: #000040; font-size: 14px;">
<textarea id="code" style="width: 400px; height: 400px;">
(def canvas (JS.document.getElementById "canvas"))
(def context (canvas.getContext "2d"))

(let ((img (new JS.Image))
      (x 0))
  (labels
   ((draw ()
      ;; Fill background.
      (set! context.fillStyle "rgb(0, 0, 255)")
      (context.fillRect 0 0 canvas.width canvas.height)

      ;; Draw line.
      (context.beginPath)
      (set! context.strokeStyle "#ff0000")
      (context.moveTo 0 0)
      (context.lineTo canvas.width canvas.height)
      (context.closePath)
      (context.stroke)

      (context.drawImage img x
                         (* (- canvas.height img.height) 0.5))

      (set! x (let ((nextx (+ x 1)))
                (if (> nextx canvas.width) 0 nextx)))

      (JS.window.requestAnimationFrame draw)))

   (set! img.src "smile.png")
   (set! img.onload draw)))
</textarea>
        </div>
        <button onClick="runTextAreaCode()">Run</button>
      </div>
      <div id="canvas-folder" style="width:400px; height: 400px; margin:0; float: left">
        <canvas id="canvas" width="400" height="400">
      </div>
      <div style="clear:both;"></div>
    </div>
    <script src="javascripts/run-canvas.js"></script>

    <p><a href="https://github.com/tyfkda/lisp2js">View On GitHub</a></p>
  </body>
</html>
