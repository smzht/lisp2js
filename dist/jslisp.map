{"version":3,"file":"jslisp.js","sources":["webpack:///jslisp.js"],"sourcesContent":["!function(e){var r={};function n(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var i in e)n.d(t,i,function(r){return e[r]}.bind(null,i));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,\"a\",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p=\"\",n(n.s=1)}([function(module,exports,__webpack_require__){\"use strict\";var _typeof=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},_createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,\"value\"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!r||\"object\"!=typeof r&&\"function\"!=typeof r?e:r}function _inherits(e,r){if(\"function\"!=typeof r&&null!==r)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError(\"Cannot call a class as a function\")}var SObject=function e(){_classCallCheck(this,e)},_Symbol=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.name=e,n}return _inherits(r,SObject),_createClass(r,[{key:\"toString\",value:function(){return this.name}}],[{key:\"getTypeName\",value:function(){return\"symbol\"}}]),r}(),Keyword=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.name=e,n}return _inherits(r,SObject),_createClass(r,[{key:\"toString\",value:function(e){return e?\":\"+this.name:this.name}}],[{key:\"getTypeName\",value:function(){return\"keyword\"}}]),r}(),Cons=function(e){function r(e,n,t,i){_classCallCheck(this,r);var o=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return o.car=e,o.cdr=n,null!=t&&(o.lineNo=t,o.path=i),o}return _inherits(r,SObject),_createClass(r,[{key:\"toString\",value:function(e){var n=r.canAbbrev(this);if(n)return\"\"+n+makeString(this.cdr.car,e);var t=[],i=\"(\",o=void 0;for(o=this;o instanceof r;o=o.cdr)t.push(i),t.push(makeString(o.car,e)),i=\" \";return o!==LISP.nil&&(t.push(\" . \"),t.push(makeString(o,e))),t.push(\")\"),t.join(\"\")}},{key:\"toArray\",value:function(){for(var e=[],n=this;n instanceof r;n=n.cdr)e.push(n.car);return e}}],[{key:\"getTypeName\",value:function(){return\"pair\"}},{key:\"canAbbrev\",value:function(e){var n={quote:\"'\",quasiquote:\"`\",unquote:\",\",\"unquote-splicing\":\",@\"};return!!(e.car instanceof _Symbol&&e.car.name in n&&e.cdr instanceof r&&LISP[\"eq?\"](e.cdr.cdr,LISP.nil))&&n[e.car.name]}}]),r}(),HashTable=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,SObject),_createClass(r,[{key:\"toString\",value:function(){var e=\"\";for(var r in this)this.hasOwnProperty(r)&&(e.length>0&&(e+=\", \"),e+=r+\":\"+makeString(this[r],!0));return\"#table<\"+e+\">\"}}],[{key:\"getTypeName\",value:function(){return\"table\"}}]),r}(),Stream=function(e){function r(){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e.str=\"\",e.lineNo=0,e}return _inherits(r,SObject),_createClass(r,[{key:\"close\",value:function(){}},{key:\"peek\",value:function(){var e=this.fetch();return null==e?e:this.str[0]}},{key:\"getc\",value:function(){var e=this.peek();return null==e?e:(this.str=this.str.slice(1),e)}},{key:\"ungetc\",value:function(e){this.str?this.str=e+this.str:this.str=e}},{key:\"match\",value:function(e,r){var n=this.fetch();if(null==n)return n;var t=this.str.match(e);return t&&!r&&(this.str=RegExp.rightContext),t}},{key:\"eof\",value:function(){return null==this.str}},{key:\"getLine\",value:function(){var e=this.str||this.readLine();return this.str=\"\",e}},{key:\"fetch\",value:function(){if(null==this.str)return null;for(;\"\"===this.str;){if(null==(this.str=this.readLine()))return;++this.lineNo}return this.str}}]),r}(),StrStream=function(e){function r(e){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.str=e,n.lineNo=1,n}return _inherits(r,Stream),_createClass(r,[{key:\"readLine\",value:function(){return null}}]),r}(),inspectString=function(e){var r={\"\\\\\":\"\\\\\\\\\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\r\":\"\\\\r\",'\"':'\\\\\"'};return'\"'+e.replace(/[\\x00-\\x1f\\\"\\\\]/g,function(e){return e in r?r[e]:\"\\\\x\"+(\"0\"+e.charCodeAt(0).toString(16)).slice(-2)})+'\"'},makeString=function e(r,n){if(r===LISP.nil)return\"nil\";if(r===LISP.t)return\"t\";switch(void 0===r?\"undefined\":_typeof(r)){case\"string\":return n?inspectString(r):r;case\"function\":return r.name?\"#<function \"+r.name+\">\":\"#<function>\";default:return r instanceof Array?\"#(\"+r.map(function(r){return e(r,n)}).join(\" \")+\")\":null==r?\"\"+r:r.toString(n)}},LISP=function(createLisp,installEval){var LISP=function(e){var r={},n=function(e){return e?r.t:r.nil};r.nil=!1,r.t=!0,r.isTrue=function(e){return e!==r.nil&&null!=e},r._getRestArgs=function(e,n){return function(e){for(var n=r.nil,t=e.length;--t>=0;)n=r.cons(e[t],n);return n}(Array.prototype.slice.call(e,n))},r._output=\"undefined\"!=typeof process?function(e){process.stdout.write(e)}:function(e){console.log(e)},r.error=function(){throw new Error(Array.prototype.slice.call(arguments).join(\", \"))},r.new=function(e){return new(Function.prototype.bind.apply(e,arguments))},r[\"symbol->string\"]=function(e){return e.name};var t={};r.intern=function(e){return e in t?t[e]:t[e]=new _Symbol(e)};var i=0;r.gensym=function(){return r.intern(\"__\"+ ++i)};var o={};r[\"make-keyword\"]=function(e){return e in o?o[e]:o[e]=new Keyword(e)},r[\"keyword->string\"]=function(e){return e.name},r.type=function(e){var n=void 0;return e===r.nil||e===r.t?n=\"bool\":\"object\"===(n=void 0===e?\"undefined\":_typeof(e))&&(e instanceof Array&&(n=\"vector\"),e instanceof RegExp?n=\"regexp\":e instanceof SObject&&(n=e.constructor.getTypeName())),r.intern(n)},r[\"eq?\"]=function(e,r){return n(e===r)},r.cons=function(e,r){return new Cons(e,r)},r.car=function(e){return e instanceof Cons?e.car:e},r.cdr=function(e){return e instanceof Cons?e.cdr:r.nil},r[\"set-car!\"]=function(e,r){return e.car=r},r[\"set-cdr!\"]=function(e,r){return e.cdr=r},r.list=function(){for(var e=r.nil,n=arguments.length;--n>=0;)e=r.cons(arguments[n],e);return e},r[\"number->string\"]=function(e,r){return e.toString(r)},r[\"+\"]=function(){if(0===arguments.length)return 0;for(var e=arguments[0],r=1;r<arguments.length;++r)e+=arguments[r];return e},r[\"*\"]=function(){if(0===arguments.length)return 1;for(var e=arguments[0],r=1;r<arguments.length;++r)e*=arguments[r];return e},r[\"-\"]=function(){if(0===arguments.length)return 0;var e=arguments[0];if(1===arguments.length)return-e;for(var r=1;r<arguments.length;++r)e-=arguments[r];return e},r[\"/\"]=function(){if(0===arguments.length)return 1;var e=arguments[0];if(1===arguments.length)return 1/e;for(var r=1;r<arguments.length;++r)e/=arguments[r];return e},r[\"%\"]=function(){if(0===arguments.length)return 0;var e=arguments[0];if(1===arguments.length)return e;for(var r=1;r<arguments.length;++r)e%=arguments[r];return e},r[\"<\"]=function(){if(arguments.length>0)for(var e=arguments[0],n=1;n<arguments.length;++n){var t=arguments[n];if(!(e<t))return r.nil;e=t}return r.t},r[\">\"]=function(){if(arguments.length>0)for(var e=arguments[0],n=1;n<arguments.length;++n){var t=arguments[n];if(!(e>t))return r.nil;e=t}return r.t},r[\"<=\"]=function(){if(arguments.length>0)for(var e=arguments[0],n=1;n<arguments.length;++n){var t=arguments[n];if(!(e<=t))return r.nil;e=t}return r.t},r[\">=\"]=function(){if(arguments.length>0)for(var e=arguments[0],n=1;n<arguments.length;++n){var t=arguments[n];if(!(e>=t))return r.nil;e=t}return r.t},r[\"string=?\"]=function(e,r){return n(e===r)},r[\"string-append\"]=function(){return Array.prototype.slice.call(arguments).join(\"\")},r[\"string-join\"]=function(e,n){return e===r.nil?\"\":e.toArray().join(n)},r[\"string-length\"]=function(e){return e.length},r[\"string-ref\"]=function(e,r){return e[r]},r.substring=function(e,r,n){return e.slice(r,n)},r[\"string-scan\"]=function(e,n){var t=e.indexOf(n);return t>=0?t:r.nil},r[\"string->number\"]=function(e,r){return r?parseInt(e,r):parseFloat(e)},r[\"char->number\"]=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.charCodeAt(r)},r[\"number->char\"]=function(e){return String.fromCharCode(e)},r[\"x->string\"]=makeString,r.print=function(e,n){var t=makeString(e);return n?n.write(t):r._output(t),e},r.puts=function(e){return r._output(makeString(e)),\"undefined\"!=typeof process&&r._output(\"\\n\"),e},r.write=function(e){return r._output(makeString(e,10)),e},r.apply=function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),i=1;i<n;i++)t[i-1]=arguments[i];if(t.length>0){var o=t.pop();o!==r.nil&&(t=t.concat(o.toArray()))}return e.apply(null,t)},r.JS=e,r[\"make-hash-table\"]=function(){return new HashTable},r[\"hash-table-exists?\"]=function(e,n){return n in e?r.t:r.nil},r[\"hash-table-get\"]=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.nil;return n in e?e[n]:t},r[\"hash-table-put!\"]=function(e,r,n){return e[r]=n},r.vector=function(){return Array.prototype.slice.call(arguments)},r[\"make-vector\"]=function(e,n){void 0===n&&(n=r.nil);for(var t=new Array(e),i=0;i<e;++i)t[i]=n;return t},r[\"vector-length\"]=function(e){return e.length},r[\"vector-ref\"]=function(e,r){return e[r]},r[\"vector-set!\"]=function(e,r,n){return e[r]=n},r.regexp=function(e){return new RegExp(e)},r.rxmatch=function(e,r){return n(e.exec(r))},r[\"regexp-replace-all\"]=function(e,r,n){if(!e.global){var t=e.toString(),i=t.lastIndexOf(\"/\");e=new RegExp(t.slice(1,i),t.slice(i+1)+\"g\")}return r.replace(e,function(e){return n(function(){return e})})},r[\"regexp->string\"]=function(e){var r=e.toString();return r.slice(1,r.length-1)},r[\"make-string-input-stream\"]=function(e,r,n){return void 0===r&&void 0===n||(e=e.slice(0|r,n|e.length)),new StrStream(e)},r.NoCloseParenException=function(){},r.NoCloseParenException.prototype.toString=function(){return\"No close paren\"},r.NoCloseQuoteException=function(){},r.NoCloseQuoteException.prototype.toString=function(){return\"No close quote\"},r.UnexpectedCharacterException=function(e){this.char=e},r.UnexpectedCharacterException.prototype.toString=function(){return\"Unexpected character: \"+this.char.toString()};var u=new RegExp(\"^([^.\\\\s(){}\\\\[\\\\]'`,;#\\\"][^\\\\s(){}\\\\[\\\\]'`,;#\\\"]*)\"),c=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:\"skipWhitespaces\",value:function(e){do{if(e.eof())return!1}while(e.match(/^(\\s+|$)/));return!0}},{key:\"read\",value:function(n){if(!e.skipWhitespaces(n))return null;var t=n.peek();if(null==t)return null;var i=r[\"*readtable*\"];if(i&&t in i)return i[t](n,n.getc());var o=n.match(u);if(o)return e.readSymbolOrNumber(o[1]);throw new r.UnexpectedCharacterException(n.peek())}},{key:\"readSymbolOrNumber\",value:function(e){return\"nil\"===e?r.nil:\"t\"===e?r.t:\":\"===e[0]?r[\"make-keyword\"](e.slice(1)):e.match(/^([+\\-]?[0-9]+(\\.[0-9]*)?)$/)?parseFloat(e):r.intern(e)}}]),e}();return r.read=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r[\"*stdin*\"],n=arguments[1],t=arguments[2],i=c.read(e);if(null!=i)return i;if(r.isTrue(n))throw new Error(\"EOF\");return null!=t?t:r.nil},r[\"read-line\"]=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:r[\"*stdin*\"]).getLine();return null==e?r.nil:(e.length>0&&\"\\n\"===e[e.length-1]&&(e=e.slice(0,e.length-1)),e)},r[\"read-char\"]=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:r[\"*stdin*\"]).getc();return null!=e?e:r.nil},r[\"unread-char\"]=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r[\"*stdin*\"];if(\"string\"!=typeof e)throw InvalidArgumentException(\"string expected, but \"+makeString(e));return n.ungetc(e),r.nil},r}(\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:{});return function(LISP){LISP.eval=function _eval(exp){return eval(LISP.compile(exp))}}(LISP),LISP}();module.exports={LISP:LISP,Stream:Stream}},function(e,r,n){\"use strict\";var t=require(\"fs\"),i=require(\"readline\"),o=require(\"tty\"),u=n(2),c=n(3).LISP;n(9)(c);var s=function(e,r){for(var n=void 0;;){var t=c.read(e);if(t===c.nil)return n;r?(n=c.compile(t),c.print(\"  \"+n+\";\\n\")):n=c.eval(t)}},a=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return s(c[\"make-string-input-stream\"](e),r)},l=function(e){console.error(e.toString())},f=function(){var e=i.createInterface(process.stdin,process.stdout);process.stdin.resume(),process.stdin.setEncoding(\"utf8\");var r=[];e.setPrompt(\"> \"),e.prompt(),e.on(\"line\",function(n){r.push(n);try{var t=r.join(\"\\n\");if(t.match(/^\\s*$/))r.length=0;else{var i=a(t);r.length=0,console.log(c[\"x->string\"](i,10))}e.setPrompt(\"> \"),e.prompt()}catch(n){n instanceof c.NoCloseParenException?e.setPrompt(\". \"):(l(n),r.length=0,e.setPrompt(\"> \")),e.prompt()}}).on(\"close\",function(){if(r.length>0)return console.error(\"Input not terminated: [\"+r+\"]\"),void process.exit(1);process.exit(0)})},p=function(){process.stdin.resume(),process.stdin.setEncoding(\"utf8\");try{return c.load(c[\"*stdin*\"])}catch(e){l(e),process.exit(1)}};function d(e){var r=u(e,{\"-c\":\"\",\"-v, --version\":\"\"}),n=r.options.c;if(r.options.v)return console.log(\"JsLisp: version \"+c[\"*version*\"]),process.exit(0);if(0===r.argv.length){if(o.isatty(0))return f();if(!n)return p();process.stdin.resume(),process.stdin.setEncoding(\"utf8\");try{return s(c[\"*stdin*\"],n)}catch(e){l(e),process.exit(1)}}try{c[\"*argv*\"]=c[\"vector->list\"](r.argv.slice(1));var i=0;if(n){console.log(\"module.export = function(LISP) {\"),console.log(\"  'use strict';\");var d=t.readFileSync(r.argv[0],\"utf-8\"),m=d.match(/^#!(.*)\\n/);m&&(d=d.slice(m[0].length)),a(d,n),console.log(\"}\")}else c.load(r.argv[0]),\"main\"in c&&(i=c.main(c.cons(r.argv[0],c[\"*argv*\"])));i&&process.exit(i)}catch(e){l(e),process.exit(1)}}var m={LISP:c,main:d};e.exports=m,\"undefined\"!=typeof __module&&(__module.exports=m,require.main===__module&&d(process.argv.slice(2)))},function(e,r,n){\"use strict\";class t{constructor(e,r=\"\"){this.shortNames=[],this.longNames=[],this.params=[],this.values=[],this.defineNames(e),this.defineParams(r)}defineNames(e){Array.isArray(e)||(e=String(e).split(/,/g));for(let r of e)r=r.trim(),/^-([^\\s-])$/.test(r)?this.shortNames.push(RegExp.lastParen):this.longNames.push(r.replace(/^-+/,\"\"))}defineParams(e){e=(e=Array.isArray(e)?e.filter(Boolean).join(\" \"):String(e).trim().split(/\\s+/g)).map(e=>e.replace(/^<(.+?)>$|^\\[(.+?)\\]$|^\\((.+?)\\)$/gm,(...e)=>e.slice(1,4).filter(Boolean).join(\"\")));for(const r of e){if(!r)continue;const[,e,n=\".+\"]=r.match(/^([^=]+)(?:=(.+)?)?$/);this.params.push({name:e,pattern:n}),/\\.{3}$/.test(e)&&(this.variadic=!0)}}get bundlePattern(){if(this._bundlePattern)return this._bundlePattern;const e=this.params.map(e=>`(${e.pattern})?`).join(\"\"),r=1===this.shortNames.length?this.shortNames[0]:`[${this.shortNames.join(\"\")}]`;return this._bundlePattern=r+e}get arity(){return this.params?this.params.length:0}get names(){return this.shortNames.concat(this.longNames)}get canCollect(){return!!(this.variadic||this.values.length<this.params.length)}}function i(e){return Array.isArray(e)?e:[e]}function o(e,r){return e=e.replace(/^-+/,\"\"),!r&&/-/.test(e)&&(e=e.toLowerCase().replace(/([a-z])-+([a-z])/g,(e,r,n)=>r+n.toUpperCase())),e}function u(e){const r={};for(let n=0,t=e.length;n<t;++n)r[e[n]]=!0;return Object.keys(r)}void 0!==e.exports&&(e.exports=function(e,r=null,n={}){if(!e||0===e.length)return{options:{},argv:[]};if(null===r||\"\"===r||!1===r)return function(e,r={}){const n=new Object(null),t=[];let i;if(!e)return n;const u=e.indexOf(\"--\");-1!==u&&(i=e.slice(u+1),e=e.slice(0,u));for(let i=0,u=e.length;i<u;++i){let u=e[i];if(/^-/.test(u))if(!r.ignoreEquals&&/=/.test(u)){const e=u.split(/=/);n[u=o(e[0],r.noCamelCase)]=e.slice(1).join(\"=\")}else{u=o(u,r.noCamelCase);const t=e[i+1];if(null==t||/^-/.test(t))n[u]=!0;else{const r=e.findIndex((e,r)=>r>i&&/^-/.test(e));-1!==r?(n[u]=e.slice(i+1,r),r-i<3&&(n[u]=n[u][0]),i=r-1):n[u]=!0}}else t.push(u)}return i&&t.push(...i),{options:n,argv:t}}(e,n);if(\"[object String]\"===Object.prototype.toString.call(r)){const e=r.match(/[^\\s:]:?/g);r={},e.forEach(e=>{r[`-${e.replace(/:/,\"\")}`]=e.length>1?\"<arg>\":\"\"})}const{noAliasPropagation:c,noCamelCase:s,noBundling:a,ignoreEquals:l,duplicates:f=\"use-last\"}=n,p={},d={},m={argv:[],options:new Object(null)};for(const e in r){const n=new t(e,r[e]);for(const e of n.shortNames){if(void 0!==p[e])throw new ReferenceError(`Short option \"-${e}\" already defined`);p[`-${e}`]=n}for(const e of n.longNames){if(void 0!==d[e])throw new ReferenceError(`Long option \"--${e}\" already defined`);d[`--${e}`]=n}}let g;function h(e,r,n){switch(f){case\"use-first\":return m.options[r];case\"use-last\":default:return m.options[r]=n;case\"limit-first\":case\"limit-last\":m.argv.push(e.prevMatchedName,...i(n));break;case\"error\":const t=new TypeError(`Attempting to reassign option \"${r}\" with value(s) ${JSON.stringify(n)}`);throw t.affectedOption=e,t.affectedValue=n,t;case\"append\":const o=i(m.options[r]),u=i(n);m.options[r]=o.concat(u);break;case\"stack\":{let t=m.options[r];const o=i(n);e.stacked?m.options[r].push(i(o)):(t=i(t),m.options[r]=[t,o],e.stacked=!0);break}case\"stack-values\":{let t=m.options[r];if(!e.stacked){const r=[];for(const e of i(t))r.push([e]);t=r,e.stacked=!0}i(n).forEach((e,r)=>{void 0===t[r]&&(t[r]=Array(t[0].length-1)),t[r].push(e)}),m.options[r]=t;break}}}function v(e,r){if(c){let n=e.lastMatchedName;\"first-only\"===c&&(n=e.longNames[0]||e.shortNames[0]),n=o(n,s),m.options[n]?h(e,n,r):m.options[n]=r}else{const{names:n}=e;m.options[n[0]]&&(r=h(e,r)),e.names.forEach(e=>{e=o(e,s),m.options[e]=r})}}function b(){let e=g.values;1!==g.arity||g.variadic||(e=e[0]),v(g,e),g.values=[],g=null}function y(e){for(let r=0,n=(e=e.reverse()).length;r<n;++r){const n=e[r],t=p[n]||d[n];if(t){const n=Math.max(0,r-t.arity),i=r+1,o=e.slice(n,i).reverse();e.splice(n,o.length,...o)}}return e}const T=Object.keys(p);let q,k,_;if(!a&&T.length&&(k=u(T.map(e=>p[e].bundlePattern)).join(\"|\"),q=new RegExp(`^-(${k})+`,\"g\"),_=u(T.filter(e=>!p[e].arity).map(e=>p[e].bundlePattern)).join(\"|\"),_=new RegExp(`^(-(?:${_})+)((?!${k})\\\\S+)`),k=new RegExp(k,\"g\")),!l||q){const r=new RegExp(`^(?:${Object.keys(d).join(\"|\")})=`);for(let n=0,t=e.length;n<t;++n){let i=e[n];if(q&&(q.lastIndex=0,q.test(i))){const r=i.match(_);r&&(_.lastIndex=0,i=r[1],e.splice(n+1,0,r[2]),t=e.length);const o=[].concat(...i.match(k).map(e=>{const r=p[`-${e[0]}`],n=[`-${e[0]}`];return r.arity?(n.push(...e.match(new RegExp(r.bundlePattern)).slice(1).filter(e=>e)),n):n}));e.splice(n,1,...o),t=e.length,n+=o.length-1}else if(r.test(i)){const r=i.match(/^([^=]+)=(.+)$/);e.splice(n,1,r[1],r[2]),t=e.length,n+=1}}}\"limit-last\"===f&&(e=y(e));for(let r=0,n=e.length;r<n;++r){const n=e[r],t=p[n]||d[n];t?(t.lastMatchedName=n,g&&b(),t.arity?g=t:v(t,!0),t.prevMatchedName=n):g&&g.canCollect?g.values.push(n):(g&&b(),m.argv.push(n))}return g&&b(),\"limit-last\"===f&&(m.argv=y(m.argv)),m})},function(e,r,n){\"use strict\";for(var t=n(0).LISP,i=[n(4),n(5),n(6),n(7),n(8)],o=0;o<i.length;o++){(0,i[o])(t)}e.exports={LISP:t},\"undefined\"!=typeof window&&(window.LISP=t)},function(e,r,n){\"use strict\";e.exports=function(e){!function(r){e[\"register-macro\"]=function(n,t){return e[\"hash-table-put!\"](r,n,t),n},e[\"macroexpand-1\"]=function(n){return function(r){return e.isTrue(r)?e.apply(r,e.cdr(n)):n}(e.isTrue(e[\"pair?\"](n))?e[\"hash-table-get\"](r,e.car(n)):e.nil)}}(e[\"make-hash-table\"]()),e[\"register-macro\"](e.intern(\"defmacro\"),function(r,n){var t=e._getRestArgs(arguments,2);return e.list(e.intern(\"register-macro\"),e.list(e.intern(\"quote\"),r),e[\"list*\"](e.intern(\"lambda\"),n,t))}),e.macroexpand=function(r){return function(n){return e.isTrue(e[\"equal?\"](n,r))?r:e.macroexpand(n)}(e[\"macroexpand-1\"](r))},e[\"*readtable*\"]=e[\"make-hash-table\"](),e[\"hash-table-put!\"](e[\"*readtable*\"],e.intern(\"_dispatch-table\"),e[\"make-hash-table\"]()),e[\"set-macro-character\"]=function(r,n){return e[\"hash-table-put!\"](e[\"*readtable*\"],r,n),e.t},e[\"get-macro-character\"]=function(r){return e[\"hash-table-get\"](e[\"*readtable*\"],r)},e[\"set-dispatch-macro-character\"]=function(r,n,t){return function(i){return function(o){return e.isTrue(e[\"hash-table-exists?\"](o,r))?e.nil:e[\"hash-table-put!\"](o,r,e[\"make-hash-table\"]()),e[\"hash-table-put!\"](e[\"hash-table-get\"](o,r),n,t),e[\"hash-table-put!\"](e[\"*readtable*\"],r,i),e.t}(e[\"hash-table-get\"](e[\"*readtable*\"],e.intern(\"_dispatch-table\")))}(function(r,n){return function(t,i){return e.isTrue(e[\"hash-table-exists?\"](i,t))?e.nil:(e[\"unread-char\"](t,r),e.error(\"No dispatch macro character\",n,t)),e[\"hash-table-get\"](i,t)(r,n,t)}(e[\"read-char\"](r),e[\"hash-table-get\"](e[\"hash-table-get\"](e[\"*readtable*\"],e.intern(\"_dispatch-table\")),n))})},e[\"get-dispatch-macro-character\"]=function(r,n){return function(t){return function(r){return e.isTrue(r)?e[\"hash-table-get\"](r,n):e.nil}(e[\"hash-table-get\"](t,r))}(e[\"hash-table-get\"](e[\"*readtable*\"],e.intern(\"_dispatch-table\")))},e[\"set-macro-character\"](\";\",function(r,n){return function(n){return(n=function(){return function(t){return e.isTrue(e[\"null?\"](t))?t:e.isTrue(e[\"eq?\"](t,\"\\n\"))?e.read(r):n()}(e[\"read-char\"](r))})()}(e.nil)}),e[\"set-macro-character\"](\"'\",function(r,n){return e.list(e.intern(\"quote\"),e.read(r))}),e[\"set-macro-character\"](\"`\",function(r,n){return e.list(e.intern(\"quasiquote\"),e.read(r))}),e[\"set-macro-character\"](\",\",function(r,n){return function(n){return e.isTrue(e[\"eq?\"](n,\"@\"))?e.list(e.intern(\"unquote-splicing\"),e.read(r)):(e[\"unread-char\"](n,r),e.list(e.intern(\"unquote\"),e.read(r)))}(e[\"read-char\"](r))}),e[\"set-macro-character\"]('\"',function(r,n){return function(n){return(n=function(t){return function(i){return e.isTrue(e[\"null?\"](i))?e.error(\"NoCloseQuoteException\"):e.isTrue(e[\"eq?\"](i,'\"'))?e[\"string-join\"](e[\"reverse!\"](t),\"\"):e.isTrue(e[\"eq?\"](i,\"\\\\\"))?n(e.cons(function(n){return function(t){return e.isTrue(e[\"eq?\"](t,\"x\"))?function(n){return function(r){return e[\"number->char\"](e[\"string->number\"](e[\"string-append\"](n,r),16))}(e[\"read-char\"](r))}(e[\"read-char\"](r)):e.isTrue(e[\"eq?\"](t,\"t\"))?\"\\t\":e.isTrue(e[\"eq?\"](t,\"n\"))?\"\\n\":e.isTrue(e[\"eq?\"](t,\"r\"))?\"\\r\":n}(n)}(e[\"read-char\"](r)),t)):n(e.cons(i,t))}(e[\"read-char\"](r))})(e.nil)}(e.nil)}),e[\"set-macro-character\"](\"(\",function(r,n){return e[\"read-delimited-list\"](\")\",r,e.t)}),e[\"set-dispatch-macro-character\"](\"#\",\"|\",function(r,n,t){return function(n){return(n=function(t){return function(i){return e.isTrue(e[\"null?\"](i))?e.error(\"Block comment not closed\"):e.isTrue(e[\"eq?\"](t,\"|\"))&&e.isTrue(e[\"eq?\"](i,\"#\"))?e.read(r):n(i)}(e[\"read-char\"](r))})(e.nil)}(e.nil)}),e[\"set-dispatch-macro-character\"](\"#\",\"(\",function(r,n,t){return e.apply(e.vector,e[\"read-delimited-list\"](\")\",r,e.nil))}),e[\"set-dispatch-macro-character\"](\"#\",\"/\",function(r,n,t){return function(n){return(n=function(t){return function(r){return e.isTrue(e[\"eq?\"](r,\"/\"))?e.regexp(e[\"string-join\"](e[\"reverse!\"](t),\"\")):e.isTrue(e[\"null?\"](r))||e.isTrue(e[\"eq?\"](r,\"\\n\"))?e.error(\"Regexp not terminated\"):n(e.cons(r,t))}(e[\"read-char\"](r))})(e.nil)}(e.nil)}),e[\"set-dispatch-macro-character\"](\"#\",\".\",function(r,n,t){return e.eval(e.read(r))}),e[\"register-macro\"](e.intern(\"defun\"),function(r,n){var t=e._getRestArgs(arguments,2);return e.list(e.intern(\"def\"),r,e[\"list*\"](e.intern(\"lambda\"),n,t))}),e[\"register-macro\"](e.intern(\"let\"),function(r){var n=e._getRestArgs(arguments,1);return e.isTrue(e[\"symbol?\"](r))?function(){var r=e.list(e.nil);return function(n,t,i){return e[\"list*\"](e.list(e.intern(\"lambda\"),e.list(n),e.list(e.intern(\"set!\"),n,e[\"list*\"](e.intern(\"lambda\"),e.map(e.car,t),i)),e[\"list*\"](n,e.map(e.cadr,t))),r)}}()(r,e.car(n),e.cdr(n)):e[\"list*\"](e[\"list*\"](e.intern(\"lambda\"),e.map(e.car,r),n),e.map(e.cadr,r))}),e[\"register-macro\"](e.intern(\"let1\"),function(r,n){var t=e._getRestArgs(arguments,2);return e[\"list*\"](e.intern(\"let\"),e.list(e.list(r,n)),t)}),e[\"register-macro\"](e.intern(\"let*\"),function(r){var n=e._getRestArgs(arguments,1);return e.isTrue(e[\"null?\"](r))?e[\"list*\"](e.intern(\"progn\"),n):e.list(e.intern(\"let1\"),e.caar(r),e.cadar(r),e[\"list*\"](e.intern(\"let*\"),e.cdr(r),n))}),e[\"register-macro\"](e.intern(\"when\"),function(r){var n=e._getRestArgs(arguments,1);return e.list(e.intern(\"if\"),r,e[\"list*\"](e.intern(\"progn\"),n))}),e[\"register-macro\"](e.intern(\"unless\"),function(r){var n=e._getRestArgs(arguments,1);return e.list(e.intern(\"if\"),r,e.nil,e[\"list*\"](e.intern(\"progn\"),n))}),e[\"register-macro\"](e.intern(\"cond\"),function(){var r=e._getRestArgs(arguments,0);return e.isTrue(e[\"null?\"](r))?e.nil:function(r,n){return e.isTrue(e[\"eq?\"](e.car(r),e.t))?e[\"list*\"](e.intern(\"progn\"),e.cdr(r)):e.isTrue(e[\"null?\"](e.cdr(r)))?function(t){return e.list(e.intern(\"let\"),e.list(e.list(t,e.car(r))),e.list(e.intern(\"if\"),t,t,e[\"list*\"](e.intern(\"cond\"),n)))}(e.gensym()):e.isTrue(e[\"eq?\"](e.cadr(r),e.intern(\"=>\")))?function(t){return e.list(e.intern(\"let\"),e.list(e.list(t,e.car(r))),e.list(e.intern(\"if\"),t,e.list(e.caddr(r),t),e[\"list*\"](e.intern(\"cond\"),n)))}(e.gensym()):e.list(e.intern(\"if\"),e.car(r),e[\"list*\"](e.intern(\"progn\"),e.cdr(r)),e[\"list*\"](e.intern(\"cond\"),n))}(e.car(r),e.cdr(r))}),e[\"register-macro\"](e.intern(\"case\"),function(r){var n=e._getRestArgs(arguments,1);return function(t){return e.list(e.intern(\"let1\"),t,r,e[\"list*\"](e.intern(\"cond\"),e.map(function(r){return e.isTrue(e[\"eq?\"](e.car(r),e.t))?r:e.isTrue(e[\"null?\"](e.cdar(r)))?e[\"list*\"](e.list(e.intern(\"eq?\"),t,e.list(e.intern(\"quote\"),e.caar(r))),e.cdr(r)):e[\"list*\"](e.list(e.intern(\"member\"),t,e.list(e.intern(\"quote\"),e.car(r))),e.cdr(r))},n)))}(e.gensym())}),e[\"register-macro\"](e.intern(\"and\"),function(){var r=e.list(e.nil);return function(){var n=e._getRestArgs(arguments,0);return e.isTrue(e[\"null?\"](n))?e.t:e.isTrue(e[\"null?\"](e.cdr(n)))?e.car(n):e[\"list*\"](e.intern(\"if\"),e.car(n),e[\"list*\"](e.intern(\"and\"),e.cdr(n)),r)}}()),e[\"register-macro\"](e.intern(\"or\"),function(){var r=e._getRestArgs(arguments,0);return e.isTrue(e[\"null?\"](e.cdr(r)))?e.car(r):function(n){return e.list(e.intern(\"let1\"),n,e.car(r),e.list(e.intern(\"if\"),n,n,e[\"list*\"](e.intern(\"or\"),e.cdr(r))))}(e.gensym())}),e[\"register-macro\"](e.intern(\"progn\"),function(){var r=e._getRestArgs(arguments,0);return e.isTrue(e[\"null?\"](r))?e.nil:e.isTrue(e[\"null?\"](e.cdr(r)))?e.car(r):e[\"list*\"](e.intern(\"let\"),e.nil,r)}),e[\"register-macro\"](e.intern(\"aif\"),function(r,n){var t=e._getRestArgs(arguments,2);return e.list(e.intern(\"let1\"),e.intern(\"it\"),r,e[\"list*\"](e.intern(\"if\"),e.intern(\"it\"),n,t))}),e[\"register-macro\"](e.intern(\"awhen\"),function(r){var n=e._getRestArgs(arguments,1);return e.list(e.intern(\"aif\"),r,e[\"list*\"](e.intern(\"progn\"),n))}),e[\"register-macro\"](e.intern(\"awhile\"),function(r){var n=e._getRestArgs(arguments,1);return function(t){return e.list(e.intern(\"let\"),t,e.nil,e.list(e.intern(\"let1\"),e.intern(\"it\"),r,e[\"list*\"](e.intern(\"when\"),e.intern(\"it\"),e.append(n,e.list(e.list(t))))))}(e.gensym())}),e[\"null?\"]=function(r){return e[\"eq?\"](r,e.nil)},e.not=function(r){return e[\"eq?\"](r,e.nil)},e.caar=function(r){return e.car(e.car(r))},e.cadr=function(r){return e.car(e.cdr(r))},e.cdar=function(r){return e.cdr(e.car(r))},e.cddr=function(r){return e.cdr(e.cdr(r))},e.cadar=function(r){return e.cadr(e.car(r))},e.caddr=function(r){return e.car(e.cddr(r))},e.cdddr=function(r){return e.cdr(e.cddr(r))},e[\"equal?\"]=function(r,n){return e.isTrue(e[\"eq?\"](r,n))?e.t:function(t){return e.isTrue(e[\"eq?\"](t,e.type(n)))?function(t){return e.isTrue(e[\"eq?\"](t,e.intern(\"pair\")))?e.isTrue(e[\"equal?\"](e.car(r),e.car(n)))?e[\"equal?\"](e.cdr(r),e.cdr(n)):e.nil:e.isTrue(e[\"eq?\"](t,e.intern(\"vector\")))?function(t){return e.isTrue(e[\"eq?\"](t,e[\"vector-length\"](n)))?function(i){return(i=function(o){return function(t){return e.isTrue(t)?t:e.isTrue(e[\"equal?\"](e[\"vector-ref\"](r,o),e[\"vector-ref\"](n,o)))?i(o+1):e.nil}(e[\">=\"](o,t))})(0)}(e.nil):e.nil}(e[\"vector-length\"](r)):e.nil}(t):e.nil}(e.type(r))},e.length=function(r){return function(n){return(n=function(r,t){return e.isTrue(e[\"pair?\"](r))?n(e.cdr(r),t+1):t})(r,0)}(e.nil)},e.member=function(r,n){return e.isTrue(e[\"null?\"](n))?e.nil:e.isTrue(e[\"eq?\"](r,e.car(n)))?n:e.member(r,e.cdr(n))},e.assoc=function(r,n){return e.isTrue(e[\"null?\"](n))?e.nil:e.isTrue(e[\"eq?\"](r,e.caar(n)))?e.car(n):e.assoc(r,e.cdr(n))},e.acons=function(r,n,t){return e.cons(e.cons(r,n),t)},e.map=function(r,n){return e.isTrue(e[\"null?\"](n))?e.nil:e.cons(r(e.car(n)),e.map(r,e.cdr(n)))},e.append=function(r){var n=e._getRestArgs(arguments,1);return e.isTrue(e[\"null?\"](n))?r:e.isTrue(e[\"null?\"](r))?e.apply(e.append,n):e.cons(e.car(r),e.apply(e.append,e.cdr(r),n))},e.reverse=function(r){return function(n){return(n=function(r,t){return e.isTrue(e[\"pair?\"](r))?n(e.cdr(r),e.cons(e.car(r),t)):t})(r,e.nil)}(e.nil)},e[\"list*\"]=function(){var r=e._getRestArgs(arguments,0);return e.isTrue(e[\"null?\"](r))?e.nil:e.isTrue(e[\"null?\"](e.cdr(r)))?e.car(r):function(n){return(n=function(t,i){return e.isTrue(e[\"null?\"](e.cdr(i)))?(e[\"set-cdr!\"](t,e.car(i)),r):n(i,e.cdr(i))})(r,e.cdr(r))}(e.nil)},e[\"last-pair\"]=function(r){return e.isTrue(e[\"pair?\"](e.cdr(r)))?e[\"last-pair\"](e.cdr(r)):r},e[\"proper-list?\"]=function(r){return e.isTrue(e[\"pair?\"](r))?e[\"null?\"](e.cdr(e[\"last-pair\"](r))):e.nil},e[\"dotted->proper\"]=function(r){return e.isTrue(e[\"pair?\"](r))?e.isTrue(e[\"proper-list?\"](r))?r:function(r,n){return function(t){return e[\"set-cdr!\"](n,e.list(r)),t}(e[\"reverse!\"](n))}(e.cdr(e[\"last-pair\"](r)),e.reverse(r)):e.list(r)},e[\"vector->list\"]=function(r){return function(n){return(n=function(t,i){return e.isTrue(e[\"<\"](t,0))?i:n(t-1,e.cons(e[\"vector-ref\"](r,t),i))})(e[\"vector-length\"](r)-1,e.nil)}(e.nil)},e[\"position-if\"]=function(r,n){return function(t){return(t=function(n,i){return e.isTrue(n)?e.isTrue(r(e.car(n)))?i:t(e.cdr(n),i+1):e.nil})(n,0)}(e.nil)},e.take=function(r,n){return function(t){return(t=function(r,n,i){return e.isTrue(e[\"<=\"](r,0))||e.isTrue(e[\"null?\"](n))?e[\"reverse!\"](i):t(r-1,e.cdr(n),e.cons(e.car(n),i))})(r,n,e.nil)}(e.nil)},e.drop=function(r,n){return e.isTrue(e[\"<=\"](r,0))||e.isTrue(e[\"null?\"](n))?n:e.drop(r-1,e.cdr(n))},e.elt=function(r,n){return e.car(e.drop(r,n))},e[\"remove-if\"]=function(r,n){return function(t){return(t=function(n,i){return e.isTrue(e[\"null?\"](n))?e[\"reverse!\"](i):t(e.cdr(n),e.isTrue(r(e.car(n)))?i:e.cons(e.car(n),i))})(n,e.nil)}(e.nil)},e[\"register-macro\"](e.intern(\"dotimes\"),function(r){var n=e._getRestArgs(arguments,1);return function(){var t=e.list(0),i=e.list(1);return function(o,u,c){return e.list(e.intern(\"let1\"),u,e.cadr(r),e.list(e.intern(\"let\"),c,e.list(e[\"list*\"](o,t)),e.list(e.intern(\"if\"),e.list(e.intern(\"<\"),o,u),e[\"list*\"](e.intern(\"progn\"),e.append(n,e.list(e.list(c,e[\"list*\"](e.intern(\"+\"),o,i))))),e.caddr(r))))}}()(e.car(r),e.gensym(),e.gensym())}),e[\"register-macro\"](e.intern(\"dolist\"),function(r){var n=e._getRestArgs(arguments,1);return function(t,i,o){return e.list(e.intern(\"let\"),i,e.list(e.list(o,e.cadr(r))),e.list(e.intern(\"let1\"),t,e.list(e.intern(\"car\"),o),e[\"list*\"](e.intern(\"when\"),t,e.append(n,e.list(e.list(i,e.list(e.intern(\"cdr\"),o)))))))}(e.car(r),e.gensym(),e.gensym())}),e[\"register-macro\"](e.intern(\"flet\"),function(r){var n=e._getRestArgs(arguments,1);return e[\"list*\"](e.intern(\"let\"),e.map(function(r){return e.list(e.car(r),e[\"list*\"](e.intern(\"lambda\"),e.cdr(r)))},r),n)}),e[\"register-macro\"](e.intern(\"labels\"),function(r){var n=e._getRestArgs(arguments,1);return e[\"list*\"](e.intern(\"let\"),e.map(function(r){return e.car(r)},r),e.append(e.map(function(r){return e.list(e.intern(\"set!\"),e.car(r),e[\"list*\"](e.intern(\"lambda\"),e.cdr(r)))},r),n))}),e[\"skip-whitespaces\"]=function(r){return function(n){return(n=function(){return function(t){return function(){var i=e.list(\" \",\"\\t\",\"\\n\");return function(o){return e.isTrue(e[\"eq?\"](o,e.nil))?e.nil:e.isTrue(e.member(o,i))?n():(e[\"unread-char\"](t,r),t)}}()(t)}(e[\"read-char\"](r))})()}(e.nil)},e[\"read-delimited-list\"]=function(r,n,t){return function(n){return function(i){return(i=function(o){return function(u){return e.isTrue(e[\"null?\"](u))?e.error(\"list not closed by delimitor\",r):e.isTrue(e[\"eq?\"](u,r))?(e[\"read-char\"](n),e[\"reverse!\"](o)):e.isTrue(t)&&e.isTrue(e[\"eq?\"](u,\".\"))?function(n,t){return e[\"read-char\"](t),e[\"skip-whitespaces\"](t),function(i){return e.isTrue(e.not(e[\"eq?\"](e[\"skip-whitespaces\"](t),r)))?e.error(\"no close paren for dotted pair\"):function(r){return e[\"set-cdr!\"](n,i),e[\"read-char\"](t),r}(e[\"reverse!\"](n))}(e.read(t))}(o,n):i(e.cons(e.read(n),o))}(e[\"skip-whitespaces\"](n))})(e.nil)}(e.nil)}(function(r){return e.isTrue(r)?r:e[\"*stdin*\"]}(n))},e[\"register-macro\"](e.intern(\"deftype?\"),function(){var r=e._getRestArgs(arguments,0);return e[\"list*\"](e.intern(\"progn\"),e.map(function(){var r=e.list(e.intern(\"x\")),n=e.list(e.intern(\"type\"),e.intern(\"x\"));return function(t){return e.list(e.intern(\"defun\"),e.intern(e[\"string-append\"](t,\"?\")),r,e.list(e.intern(\"eq?\"),n,e.list(e.intern(\"quote\"),t)))}}(),r))}),e[\"symbol?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"symbol\"))},e[\"pair?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"pair\"))},e[\"number?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"number\"))},e[\"string?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"string\"))},e[\"keyword?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"keyword\"))},e[\"vector?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"vector\"))},e[\"table?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"table\"))},e[\"regexp?\"]=function(r){return e[\"eq?\"](e.type(r),e.intern(\"regexp\"))},e[\"reverse!\"]=function(r){return function(n){return(n=function(r,t){return e.isTrue(e[\"pair?\"](t))?function(i){return e[\"set-cdr!\"](t,r),n(t,i)}(e.cdr(t)):r})(e.nil,r)}(e.nil)},e[\"read-from-string\"]=function(r){return e.read(e[\"make-string-input-stream\"](r))}}},function(e,r,n){\"use strict\";e.exports=function(e){e.nreconc=function(r,n){return function(t){return e[\"set-cdr!\"](r,n),t}(e[\"reverse!\"](r))},e.any=function(r,n){return e.isTrue(e[\"null?\"](n))?e.nil:e.isTrue(r(e.car(n)))?e.t:e.any(r,e.cdr(n))},e.every=function(r,n){return e.isTrue(e[\"null?\"](n))?e.t:e.isTrue(r(e.car(n)))?e.every(r,e.cdr(n)):e.nil},e[\"*bq-clobberable*\"]=e.gensym(),e[\"*bq-quote-nil*\"]=e.list(e.intern(\"quote\"),e.nil),e[\"register-macro\"](e.intern(\"quasiquote\"),function(r){return e[\"bq-completely-process\"](r)}),e[\"bq-completely-process\"]=function(r){return e[\"bq-simplify\"](e[\"bq-process\"](r))},e[\"bq-process\"]=function(r){return e.isTrue(e.not(e[\"pair?\"](r)))?e.list(e.intern(\"quote\"),r):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"quasiquote\")))?e[\"bq-process\"](e[\"bq-completely-process\"](e.cadr(r))):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote\")))?e.cadr(r):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-splicing\")))?e.error(\",@~S after `\",e.cadr(r)):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-dot\")))?e.error(\",.~S after `\",e.cadr(r)):function(n){return(n=function(r,t){return e.isTrue(e.not(e[\"pair?\"](r)))?e.cons(e.intern(\"append\"),e.nreconc(t,e.list(e.list(e.intern(\"quote\"),r)))):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote\")))?(e.isTrue(e[\"null?\"](e.cddr(r)))?e.nil:e.error(\"Malformed ,~S\",r),e.cons(e.intern(\"append\"),e.nreconc(t,e.list(e.cadr(r))))):(e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-splicing\")))?e.error(\"Dotted ,@~S\",r):e.nil,e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-dot\")))?e.error(\"Dotted ,.~S\",r):e.nil,n(e.cdr(r),e.cons(e.bracket(e.car(r)),t)))})(r,e.nil)}(e.nil)},e.bracket=function(r){return e.isTrue(e.not(e[\"pair?\"](r)))?e.list(e.intern(\"list\"),e[\"bq-process\"](r)):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote\")))?e.list(e.intern(\"list\"),e.cadr(r)):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-splicing\")))?e.cadr(r):e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"unquote-dot\")))?e.list(e[\"*bq-clobberable*\"],e.cadr(r)):e.list(e.intern(\"list\"),e[\"bq-process\"](r))},e.maptree=function(r,n){return e.isTrue(e.not(e[\"pair?\"](n)))?r(n):function(r,t){return e.isTrue(e[\"equal?\"](r,e.car(n)))&&e.isTrue(e[\"equal?\"](t,e.cdr(n)))?n:e.cons(r,t)}(r(e.car(n)),e.maptree(r,e.cdr(n)))},e[\"bq-splicing-frob\"]=function(r){return e.isTrue(e[\"pair?\"](r))?function(n){return e.isTrue(n)?n:e[\"eq?\"](e.car(r),e.intern(\"unquote-dot\"))}(e[\"eq?\"](e.car(r),e.intern(\"unquote-splicing\"))):e.nil},e[\"bq-frob\"]=function(r){return e.isTrue(e[\"pair?\"](r))?function(n){return e.isTrue(n)?n:function(n){return e.isTrue(n)?n:e[\"eq?\"](e.car(r),e.intern(\"unquote-dot\"))}(e[\"eq?\"](e.car(r),e.intern(\"unquote-splicing\")))}(e[\"eq?\"](e.car(r),e.intern(\"unquote\"))):e.nil},e[\"bq-simplify\"]=function(r){return e.isTrue(e[\"pair?\"](r))?function(r){return e.isTrue(e.not(e[\"eq?\"](e.car(r),e.intern(\"append\"))))?r:e[\"bq-simplify-args\"](r)}(e.isTrue(e[\"eq?\"](e.car(r),e.intern(\"quote\")))?r:e.maptree(e[\"bq-simplify\"],r)):r},e[\"bq-simplify-args\"]=function(r){return function(n){return(n=function(r,t){return e.isTrue(e.not(e[\"null?\"](r)))?n(e.cdr(r),e.isTrue(e.not(e[\"pair?\"](e.car(r))))?e[\"bq-attach-append\"](e.intern(\"append\"),e.car(r),t):e.isTrue(e[\"eq?\"](e.caar(r),e.intern(\"list\")))&&e.isTrue(e.not(e.any(e[\"bq-splicing-frob\"],e.cdar(r))))?e[\"bq-attach-conses\"](e.cdar(r),t):e.isTrue(e[\"eq?\"](e.caar(r),e.intern(\"list*\")))&&e.isTrue(e.not(e.any(e[\"bq-splicing-frob\"],e.cdar(r))))?e[\"bq-attach-conses\"](e.reverse(e.cdr(e.reverse(e.cdar(r)))),e[\"bq-attach-append\"](e.intern(\"append\"),e.car(e.last(e.car(r))),t)):e.isTrue(e[\"eq?\"](e.caar(r),e.intern(\"quote\")))&&e.isTrue(e[\"pair?\"](e.cadar(r)))&&e.isTrue(e.not(e[\"bq-frob\"](e.cadar(r))))&&e.isTrue(e.not(e.cddar(r)))?e[\"bq-attach-conses\"](e.list(e.list(e.intern(\"quote\"),e.caadar(r))),t):e.isTrue(e[\"eq?\"](e.caar(r),e[\"*bq-clobberable*\"]))?e[\"bq-attach-append\"](e.intern(\"append!\"),e.cadar(r),t):e[\"bq-attach-append\"](e.intern(\"append\"),e.car(r),t)):t})(e.reverse(e.cdr(r)),e.nil)}(e.nil)},e[\"null-or-quoted\"]=function(r){return function(n){return e.isTrue(n)?n:e.isTrue(e[\"pair?\"](r))?e[\"eq?\"](e.car(r),e.intern(\"quote\")):e.nil}(e[\"null?\"](r))},e[\"bq-attach-append\"]=function(r,n,t){return e.isTrue(e[\"null-or-quoted\"](n))&&e.isTrue(e[\"null-or-quoted\"](t))?e.list(e.intern(\"quote\"),e.append(e.cadr(n),e.cadr(t))):e.isTrue(e[\"null?\"](t))||e.isTrue(e[\"equal?\"](t,e[\"*bq-quote-nil*\"]))?e.isTrue(e[\"bq-splicing-frob\"](n))?e.list(r,n):n:e.isTrue(e[\"pair?\"](t))&&e.isTrue(e[\"eq?\"](e.car(t),r))?e[\"list*\"](e.car(t),n,e.cdr(t)):e.list(r,n,t)},e[\"bq-attach-conses\"]=function(r,n){return e.isTrue(e.every(e[\"null-or-quoted\"],r))&&e.isTrue(e[\"null-or-quoted\"](n))?e.list(e.intern(\"quote\"),e.append(e.map(e.cadr,r),e.cadr(n))):e.isTrue(e[\"null?\"](n))||e.isTrue(e[\"equal?\"](n,e[\"*bq-quote-nil*\"]))?e.cons(e.intern(\"list\"),r):e.isTrue(e[\"pair?\"](n))&&(e.isTrue(e[\"eq?\"](e.car(n),e.intern(\"list\")))||e.isTrue(e[\"eq?\"](e.car(n),e.intern(\"list*\"))))?e.cons(e.car(n),e.append(r,e.cdr(n))):e.cons(e.intern(\"list*\"),e.append(r,e.list(n)))}}},function(e,r,n){\"use strict\";e.exports=function(e){e[\"create-scope\"]=function(r,n){return e.vector(e[\"remove-if\"](function(){var r=e.list(e.intern(\"&rest\"),e.intern(\"&body\"));return function(n){return e.member(n,r)}}(),n),e.nil,r)},e[\"scope-param\"]=function(r){return e[\"vector-ref\"](r,0)},e[\"scope-outer\"]=function(r){return e[\"vector-ref\"](r,2)},e[\"scope-add-var\"]=function(r,n){return function(t){return e[\"vector-set!\"](r,1,e.cons(e.cons(t,n),e[\"vector-ref\"](r,1))),e[\"vector-set!\"](r,0,e.cons(t,e[\"vector-ref\"](r,0))),t}(e.gensym())},e[\"scope-get-var\"]=function(r){return e[\"vector-ref\"](r,1)},e[\"scope-var?\"]=function(r,n){return e.isTrue(e[\"null?\"](r))?e.nil:e.isTrue(e.member(n,e[\"scope-param\"](r)))?e.t:e[\"scope-var?\"](e[\"scope-outer\"](r),n)},e[\"local-var?\"]=function(r,n){return e.isTrue(e[\"symbol?\"](n))?e[\"scope-var?\"](r,e[\"get-receiver\"](n)):e.nil},e[\"special-var?\"]=function(){var r=e.list(e.intern(\"this\"));return function(n,t){return e.member(t,r)}}(),e[\"get-receiver\"]=function(r){return function(n){return function(t){return e.isTrue(t)?e.intern(e.substring(n,0,t)):r}(e[\"string-scan\"](n,\".\"))}(e[\"symbol->string\"](r))},e[\"register-macro\"](e.intern(\"record\"),function(r,n){var t=e._getRestArgs(arguments,2);return e.list(e.intern(\"apply\"),e[\"list*\"](e.intern(\"lambda\"),n,t),r)}),e[\"register-macro\"](e.intern(\"record-case\"),function(r){var n=e._getRestArgs(arguments,1);return function(t){return e.list(e.intern(\"let1\"),t,r,e[\"list*\"](e.intern(\"case\"),e.list(e.intern(\"car\"),t),e.map(function(r){return e.isTrue(e[\"eq?\"](e.car(r),e.t))?r:function(n){return e.list(e.list(n),e[\"list*\"](e.intern(\"record\"),e.list(e.intern(\"cdr\"),t),e.cdar(r),e.cdr(r)))}(e.caar(r))},n)))}(e.gensym())}),e[\"parse-quoted-value\"]=function(r){return e.isTrue(e[\"pair?\"](r))?e.isTrue(e[\"proper-list?\"](r))?e.vector(e[\"make-keyword\"](\"FUNCALL\"),e.vector(e[\"make-keyword\"](\"REF\"),e.intern(\"list\")),e.map(e[\"parse-quoted-value\"],r)):e.vector(e[\"make-keyword\"](\"FUNCALL\"),e.vector(e[\"make-keyword\"](\"REF\"),e.isTrue(e[\"pair?\"](e.cdr(r)))?e.intern(\"list*\"):e.intern(\"cons\")),e.map(e[\"parse-quoted-value\"],e[\"dotted->proper\"](r))):e.isTrue(e[\"vector?\"](r))?e.vector(e[\"make-keyword\"](\"FUNCALL\"),e.vector(e[\"make-keyword\"](\"REF\"),e.intern(\"vector\")),e.map(e[\"parse-quoted-value\"],e[\"vector->list\"](r))):e.vector(e[\"make-keyword\"](\"CONST\"),r)},function(r){(function(n){n=function(r){return e.isTrue(r)?e.isTrue(e[\"symbol?\"](e.car(r)))?n(e.cdr(r)):e[\"compile-error\"](\"function parameter must be symbol, but\",e.car(r)):e.nil},e[\"parse-list\"]=function(t,i){return function(o){return function(u){return e.isTrue(e[\"eq?\"](u,e.intern(\"quote\")))?e.apply(function(r){return e.isTrue(e[\"pair?\"](r))||e.isTrue(e[\"vector?\"](r))?e.vector(e[\"make-keyword\"](\"REF\"),e[\"scope-add-var\"](i,e[\"parse-quoted-value\"](r))):e.vector(e[\"make-keyword\"](\"CONST\"),r)},e.cdr(o)):e.isTrue(e[\"eq?\"](u,e.intern(\"if\")))?e.apply(function(r,n){var t=e._getRestArgs(arguments,2);return e.vector(e[\"make-keyword\"](\"IF\"),e[\"parse*\"](r,i),e[\"parse*\"](n,i),e.isTrue(e[\"null?\"](t))?e.nil:e[\"parse*\"](e.car(t),i))},e.cdr(o)):e.isTrue(e[\"eq?\"](u,e.intern(\"set!\")))?e.apply(function(r,n){return e.vector(e[\"make-keyword\"](\"SET!\"),e[\"parse*\"](r,i),e[\"parse*\"](n,i))},e.cdr(o)):e.isTrue(e[\"eq?\"](u,e.intern(\"lambda\")))?e.apply(function(t){var o=e._getRestArgs(arguments,1);return n(t),function(n){return e.vector(e[\"make-keyword\"](\"LAMBDA\"),n,t,r(o,n))}(e[\"create-scope\"](i,t))},e.cdr(o)):e.isTrue(e[\"eq?\"](u,e.intern(\"def\")))?e.apply(function(r,n){return e.vector(e[\"make-keyword\"](\"DEF\"),e[\"parse*\"](r,i),e[\"parse*\"](n,i))},e.cdr(o)):e.isTrue(e[\"null?\"](t))||e.isTrue(e[\"proper-list?\"](t))?e.vector(e[\"make-keyword\"](\"FUNCALL\"),e[\"parse*\"](e.car(t),i),r(e.cdr(t),i)):e[\"compile-error\"](\"funcall must be proper list, but\",t)}(e.car(o))}(t)}})(e.nil)}(function(r,n){return e.map(function(r){return e[\"parse*\"](r,n)},r)}),e[\"parse*\"]=function(r,n){return e.isTrue(e[\"pair?\"](r))?e.isTrue(e[\"local-var?\"](n,e.car(r)))?e[\"parse-list\"](r,n):function(r){return e.isTrue(e[\"pair?\"](r))?e[\"parse-list\"](r,n):e[\"parse*\"](r,n)}(e.macroexpand(r)):e.isTrue(e[\"symbol?\"](r))?e.vector(e[\"make-keyword\"](\"REF\"),r):e[\"parse-quoted-value\"](r)},e.parse=function(r){return e[\"parse*\"](r,e[\"create-scope\"](e.nil,e.nil))}}},function(e,r,n){\"use strict\";e.exports=function(e){e[\"expand-args\"]=function(r,n){return e[\"string-join\"](e.map(function(r){return e[\"compile*\"](r,n)},r),\", \")},e[\"expand-body\"]=function(r,n){return e.isTrue(e[\"null?\"](r))?\"LISP.nil\":e[\"expand-args\"](r,n)},function(r){e[\"hash-table-put!\"](r,\"\\\\\",\"\\\\\\\\\"),e[\"hash-table-put!\"](r,\"\\t\",\"\\\\t\"),e[\"hash-table-put!\"](r,\"\\n\",\"\\\\n\"),e[\"hash-table-put!\"](r,\"\\r\",\"\\\\r\"),e[\"hash-table-put!\"](r,'\"','\\\\\"'),e[\"escape-char\"]=function(n){return function(r){return e.isTrue(r)?r:n}(e[\"hash-table-get\"](r,n))}}(e[\"make-hash-table\"]()),e[\"escape-string\"]=function(r){return e[\"regexp-replace-all\"](/[\\\\\\t\\n\\r\"]/,r,function(r){return e[\"escape-char\"](r())})},e[\"escape-sym-char\"]=function(r){return e[\"string-append\"](\"$\",function(r,n){return function(r){return function(t){return function(n){return e.substring(r,t-n,t)}(e[\"string-length\"](n))}(e[\"string-length\"](r))}(e[\"string-append\"](n,e[\"number->string\"](r,16)))}(e[\"char->number\"](r),\"00\"))},function(r){e[\"escape-param-name\"]=function(n){return e.isTrue(e.member(n,r))?e[\"string-append\"](\"__\",e[\"symbol->string\"](n)):e[\"regexp-replace-all\"](/[^0-9A-Za-z_.]/,e[\"symbol->string\"](n),function(r){return e[\"escape-sym-char\"](e[\"string-ref\"](r(),0))})}}(e.list(e.intern(\"null\"),e.intern(\"true\"),e.intern(\"false\"),e.intern(\"break\"),e.intern(\"case\"),e.intern(\"catch\"),e.intern(\"continue\"),e.intern(\"debugger\"),e.intern(\"default\"),e.intern(\"delete\"),e.intern(\"do\"),e.intern(\"else\"),e.intern(\"finally\"),e.intern(\"for\"),e.intern(\"function\"),e.intern(\"if\"),e.intern(\"in\"),e.intern(\"instanceof\"),e.intern(\"new\"),e.intern(\"return\"),e.intern(\"switch\"),e.intern(\"throw\"),e.intern(\"try\"),e.intern(\"typeof\"),e.intern(\"var\"),e.intern(\"void\"),e.intern(\"while\"),e.intern(\"with\"))),e[\"compile-symbol\"]=function(r,n){return e.isTrue(e[\"local-var?\"](n,r))||e.isTrue(e[\"special-var?\"](n,r))?e[\"escape-param-name\"](r):function(r){return e.isTrue(e.rxmatch(/^[0-9A-Za-z_.]*$/,r))?e[\"string-append\"](\"LISP.\",r):e[\"string-append\"]('LISP[\"',e[\"escape-string\"](r),'\"]')}(e[\"symbol->string\"](r))},e[\"compile-keyword\"]=function(r){return e[\"string-append\"]('LISP[\"make-keyword\"](\"',e[\"escape-string\"](e[\"keyword->string\"](r)),'\")')},e[\"compile-vector\"]=function(r,n){return e[\"string-append\"](\"[\",e[\"string-join\"](e.map(function(r){return e[\"compile-quote\"](r,n)},e[\"vector->list\"](r)),\", \"),\"]\")},e[\"compile-regexp\"]=function(r){return e[\"string-append\"](\"/\",e[\"regexp->string\"](r),\"/\")},e[\"compile-literal\"]=function(r,n){return e.isTrue(e[\"number?\"](r))?e[\"number->string\"](r):e.isTrue(e[\"symbol?\"](r))?e[\"compile-symbol\"](r,n):e.isTrue(e[\"keyword?\"](r))?e[\"compile-keyword\"](r):e.isTrue(e[\"string?\"](r))?e[\"x->string\"](r,e.t):e.isTrue(e[\"vector?\"](r))?e[\"compile-vector\"](r,n):e.isTrue(e[\"regexp?\"](r))?e[\"compile-regexp\"](r):e.isTrue(e[\"null?\"](r))?\"LISP.nil\":e.isTrue(e[\"eq?\"](r,e.t))?\"LISP.t\":e.error(e[\"string-append\"](\"compile-literal: [\",r,\"]\"))},e[\"compile-unary-op\"]=function(r,n,t){return e[\"string-append\"](\"(\",e[\"symbol->string\"](r),e[\"compile*\"](n,t),\")\")},e[\"compile-binop\"]=function(r,n,t){return e[\"string-append\"](\"(\",e[\"string-join\"](e.map(function(r){return e[\"compile*\"](r,t)},n),e[\"string-append\"](\" \",e[\"symbol->string\"](r),\" \")),\")\")},function(r,n,t){e[\"compile-funcall\"]=function(i,o,u){return e.isTrue(e[\"eq?\"](e[\"vector-ref\"](i,0),e[\"make-keyword\"](\"REF\")))&&e.isTrue(e.not(e[\"local-var?\"](u,e[\"vector-ref\"](i,1))))&&e.isTrue(e.not(e[\"null?\"](o)))?function(c){return e.isTrue(t(c))&&e.isTrue(e.not(e[\"null?\"](e.cdr(o))))?e[\"compile-binop\"](c,o,u):e.isTrue(n(c))&&e.isTrue(e[\"null?\"](e.cdr(o)))?e[\"compile-unary-op\"](c,e.car(o),u):r(i,o,u)}(e[\"vector-ref\"](i,1)):r(i,o,u)}}(function(r,n,t){return e[\"string-append\"](e[\"compile*\"](r,t),\"(\",e[\"expand-args\"](n,t),\")\")},function(){var r=e.list(e.intern(\"+\"),e.intern(\"-\"),e.intern(\"!\"),e.intern(\"~\"));return function(n){return e.member(n,r)}}(),function(){var r=e.list(e.intern(\"+\"),e.intern(\"-\"),e.intern(\"*\"),e.intern(\"/\"),e.intern(\"%\"));return function(n){return e.member(n,r)}}()),e[\"compile-quote\"]=function(r,n){return e.isTrue(e[\"pair?\"](r))?e[\"compile*\"](e.list(e.intern(\"cons\"),e.list(e.intern(\"quote\"),e.car(r)),e.list(e.intern(\"quote\"),e.cdr(r))),n):e.isTrue(e[\"symbol?\"](r))?e[\"string-append\"]('LISP.intern(\"',e[\"escape-string\"](e[\"symbol->string\"](r)),'\")'):e.isTrue(e[\"keyword?\"](r))?e[\"compile-keyword\"](r):e[\"compile-literal\"](r,n)},function(r){(function(n){n=function(t,i){return e.isTrue(r(e[\"make-keyword\"](\"IF\"),t))&&e.isTrue(function(n){return function(t){return e.isTrue(t)?t:e.isTrue(r(e[\"make-keyword\"](\"CONST\"),n))?e[\"eq?\"](e[\"vector-ref\"](n,1),e.nil):e.nil}(e.not(n))}(e[\"vector-ref\"](t,3)))?e[\"string-append\"](\"(\",n(e[\"vector-ref\"](t,1),i),\" && \",n(e[\"vector-ref\"](t,2),i),\")\"):e.isTrue(r(e[\"make-keyword\"](\"FUNCALL\"),t))&&e.isTrue(r(e[\"make-keyword\"](\"LAMBDA\"),e[\"vector-ref\"](t,1)))&&e.isTrue(e[\"eq?\"](e.length(e[\"scope-param\"](e[\"vector-ref\"](e[\"vector-ref\"](t,1),1))),1))&&e.isTrue(e[\"eq?\"](e.length(e[\"vector-ref\"](t,2)),1))&&e.isTrue(e[\"eq?\"](e.length(e[\"vector-ref\"](e[\"vector-ref\"](t,1),3)),1))&&e.isTrue(function(n){return r(e[\"make-keyword\"](\"IF\"),n),r(e[\"make-keyword\"](\"REF\"),e[\"vector-ref\"](n,1)),e[\"eq?\"](e[\"vector-ref\"](e[\"vector-ref\"](n,1),1),e.car(e[\"scope-param\"](e[\"vector-ref\"](e[\"vector-ref\"](t,1),1)))),e[\"equal?\"](e[\"vector-ref\"](n,1),e[\"vector-ref\"](n,2))}(e.car(e[\"vector-ref\"](e[\"vector-ref\"](t,1),3))))?function(r){return function(r,t){return e.isTrue(e[\"null?\"](t))||e.isTrue(e[\"eq?\"](e[\"vector-ref\"](t,0),e[\"make-keyword\"](\"CONST\")))&&e.isTrue(e[\"eq?\"](e[\"vector-ref\"](t,1),e.nil))?n(r,i):e[\"string-append\"](\"(\",n(r,i),\" || \",n(t,i),\")\")}(e.car(e[\"vector-ref\"](t,2)),e[\"vector-ref\"](r,3))}(e.car(e[\"vector-ref\"](e[\"vector-ref\"](t,1),3))):e[\"string-append\"](\"LISP.isTrue(\",e[\"compile*\"](t,i),\")\")},e[\"compile-if\"]=function(r,t,i,o){return e[\"string-append\"](\"(\",n(r,o),\" ? \",e[\"compile*\"](t,o),\" : \",e.isTrue(i)?e[\"compile*\"](i,o):\"LISP.nil\",\")\")}})(e.nil)}(function(r,n){return e[\"eq?\"](e[\"vector-ref\"](n,0),r)}),e[\"compile-set!\"]=function(r,n,t){return e[\"string-append\"](e[\"compile*\"](r,t),\" = \",e[\"compile*\"](n,t))},e[\"compile-lambda\"]=function(r,n,t,i,o){return e.isTrue(e[\"null?\"](n))||e.isTrue(e[\"pair?\"](n))?e.nil:e.error(\"function parameters must be a list\"),function(i){return function(n,i){return e[\"string-append\"](\"(function \",e.isTrue(e[\"null?\"](r))?\"\":e[\"escape-param-name\"](r),\"(\",e[\"string-join\"](e.map(function(r){return e[\"escape-param-name\"](r)},n),\", \"),\"){\",e.isTrue(e[\"null?\"](i))?\"\":e[\"string-append\"](\"var \",e[\"escape-param-name\"](i),\" = LISP._getRestArgs(arguments, \",e[\"number->string\"](e.length(n)),\"); \"),\"return (\",e[\"expand-body\"](t,o),\");})\")}(e.isTrue(i)?e.take(i,n):n,e.isTrue(i)?e.elt(i+1,n):e.nil)}(e[\"position-if\"](function(){var r=e.list(e.intern(\"&rest\"),e.intern(\"&body\"));return function(n){return e.member(n,r)}}(),n))},e[\"compile-def\"]=function(r,n,t){return e[\"string-append\"](e[\"compile*\"](r,t),\" = \",e.isTrue(e[\"eq?\"](e[\"vector-ref\"](n,0),e[\"make-keyword\"](\"LAMBDA\")))?e[\"compile-lambda-node\"](n,e[\"vector-ref\"](r,1)):e[\"compile*\"](n,t))},e[\"compile-new-scope\"]=function(r,n){return function(t){return e.isTrue(t)?e[\"string-append\"](\"(function() { var \",e[\"string-join\"](e.map(function(r){return e[\"string-append\"](e[\"escape-param-name\"](e.car(r)),\" = \",e[\"compile*\"](e.cdr(r),n))},e.reverse(t)),\", \"),\"; return \",r,\"; })()\"):r}(e[\"scope-get-var\"](n))},e[\"compile-lambda-node\"]=function(r,n,t){return function(r,i,o){return e[\"compile-new-scope\"](e[\"compile-lambda\"](n,i,o,t,r),r)}(e[\"vector-ref\"](r,1),e[\"vector-ref\"](r,2),e[\"vector-ref\"](r,3))},e[\"compile*\"]=function(r,n){return function(t){return e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"CONST\")))?e[\"compile-quote\"](e[\"vector-ref\"](r,1),n):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"REF\")))?e[\"compile-symbol\"](e[\"vector-ref\"](r,1),n):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"IF\")))?function(r,t,i){return e[\"compile-if\"](r,t,i,n)}(e[\"vector-ref\"](r,1),e[\"vector-ref\"](r,2),e[\"vector-ref\"](r,3)):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"FUNCALL\")))?e[\"compile-funcall\"](e[\"vector-ref\"](r,1),e[\"vector-ref\"](r,2),n):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"SET!\")))?e[\"compile-set!\"](e[\"vector-ref\"](r,1),e[\"vector-ref\"](r,2),n):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"LAMBDA\")))?e[\"compile-lambda-node\"](r,e.nil,n):e.isTrue(e[\"eq?\"](t,e[\"make-keyword\"](\"DEF\")))?e[\"compile-def\"](e[\"vector-ref\"](r,1),e[\"vector-ref\"](r,2),n):e[\"compile-error\"](\"Unknown AST node:\",r)}(e[\"vector-ref\"](r,0))},e[\"compile-error\"]=function(){var r=e._getRestArgs(arguments,0);return e.error(r)},e.compile=function(r){return function(n){return function(r){return e[\"compile-new-scope\"](e[\"compile*\"](r,n),n)}(e[\"parse*\"](r,n))}(e[\"create-scope\"](e.nil,e.nil))}}},function(e,r,n){\"use strict\";e.exports=function(e){e[\"*version*\"]=\"0.1.1\"}},function(e,r,n){\"use strict\";var t=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,\"value\"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}();var i=require(\"fs\"),o=n(0).Stream;e.exports=function(e){var r=4096,n=function(n){function u(e,n){!function(e,r){if(!(e instanceof r))throw new TypeError(\"Cannot call a class as a function\")}(this,u);var t=function(e,r){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!r||\"object\"!=typeof r&&\"function\"!=typeof r?e:r}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return t.fd=e,t.path=n,t.lines=[],t.index=0,t.buffer=Buffer.alloc(r),t}return function(e,r){if(\"function\"!=typeof r&&null!==r)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}(u,o),t(u,[{key:\"close\",value:function(){null!=this.fd&&(i.closeSync(this.fd),this.fd=null,this.lines.length=this.index=0,this.str=null)}},{key:\"readLine\",value:function(){for(;;){var n=\"\";if(this.index<this.lines.length){if(this.index<this.lines.length-1)return this.lines[this.index++];n=this.lines[this.index],this.lines.length=this.index=0}if(null==this.fd)return e.nil;var t=i.readSync(this.fd,this.buffer,0,r);if(t<=0)return\"\"!==n?n:null;for(var o=n+this.buffer.slice(0,t).toString(),u=0;;){var c=o.indexOf(\"\\n\",u);if(c<0){this.lines.push(0===u?o:o.slice(u));break}this.lines.push(o.slice(u,c+1)),u=c+1}this.index=0}}},{key:\"write\",value:function(e){i.write(this.fd,e)}}]),u}();e[\"*stdin*\"]=new n(process.stdin.fd,\"*stdin*\"),e[\"*stdout*\"]=new n(process.stdout.fd,\"*stdout*\"),e[\"*stderr*\"]=new n(process.stderr.fd,\"*stderr*\"),e.open=function(r,t){try{var o=i.openSync(r,t||\"r\");return new n(o,r)}catch(r){return e.nil}},e.close=function(e){return e.close(),e},e.load=function(r){var n=void 0;if(\"string\"==typeof r){if(!(n=e.open(r)))return e.error(\"Cannot open [\"+r+\"]\")}else{if(!(r instanceof o))return e.error(\"Illegal fileSpec: \"+r);n=r}n.match(/^#!/,!0)&&n.getLine();for(var t=void 0;;){var i=e.read(n);if(i===e.nil)break;t=e.eval(i)}return n!==r&&e.close(n),t},e.exit=function(e){process.exit(e)},e.jsrequire=require}}]);"],"mappings":"AAAA","sourceRoot":""}